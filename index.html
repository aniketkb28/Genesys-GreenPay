<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>CarbonCash ‚Äì Carbon Footprint Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,300;9..144,500;9..144,600;9..144,700;9..144,800&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,300&display=swap" rel="stylesheet">
<style>
:root {
  --bg-deep:    #050e08;
  --bg-card:    #0b1a0f;
  --bg-glass:   rgba(14,30,18,0.88);
  --green-glow: #22c55e;
  --green-mid:  #16a34a;
  --green-dark: #14532d;
  --leaf-light: #4ade80;
  --leaf-pale:  #86efac;
  --gold:       #fbbf24;
  --gold-dark:  #d97706;
  --red:        #f87171;
  --orange:     #fb923c;
  --blue:       #38bdf8;
  --text-pri:   #e8fced;
  --text-muted: #6b9a7a;
  --border:     rgba(34,197,94,0.13);
  --r:          22px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{background:var(--bg-deep);color:var(--text-pri);font-family:'DM Sans',sans-serif;width:100%;height:100%;overflow:hidden;}

/* ‚îÄ‚îÄ Ambient BG ‚îÄ‚îÄ */
body::before{content:'';position:fixed;inset:0;background:
  radial-gradient(ellipse 55% 45% at 20% -5%,rgba(22,163,74,.16) 0%,transparent 65%),
  radial-gradient(ellipse 45% 55% at 80% 105%,rgba(20,83,45,.25) 0%,transparent 60%);
  pointer-events:none;z-index:0;}

/* ‚îÄ‚îÄ Carbon particles floating ‚îÄ‚îÄ */
.carbon-field{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden;}
.carbon-particle{position:absolute;opacity:0;animation:floatCarbon linear infinite;}
@keyframes floatCarbon{
  0%  {transform:translateY(110vh) translateX(0) rotate(0deg) scale(.8);opacity:0;}
  6%  {opacity:.3;}
  90% {opacity:.15;}
  100%{transform:translateY(-15vh) translateX(40px) rotate(380deg) scale(.5);opacity:0;}
}

/* ‚îÄ‚îÄ App shell ‚îÄ‚îÄ */
.app{position:fixed;inset:0;z-index:2;max-width:430px;margin:0 auto;display:flex;flex-direction:column;box-shadow:0 0 60px rgba(0,0,0,.8);}

/* ‚îÄ‚îÄ Page system ‚îÄ‚îÄ */
.pages{flex:1;min-height:0;position:relative;overflow:hidden;}
.page{position:absolute;inset:0;overflow-y:auto;overflow-x:hidden;padding-bottom:12px;
  opacity:0;transform:translateX(30px);pointer-events:none;-webkit-overflow-scrolling:touch;
  transition:opacity .35s cubic-bezier(.4,0,.2,1),transform .35s cubic-bezier(.4,0,.2,1);}
.page.active{opacity:1;transform:translateX(0);pointer-events:all;}

/* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
.header{padding:16px 24px 0;display:flex;justify-content:space-between;align-items:center;}
.logo{display:flex;align-items:center;gap:8px;font-family:'Fraunces',serif;
  font-size:24px;font-weight:600;color:var(--leaf-light);letter-spacing:-.5px;}
.logo-icon{width:34px;height:34px;background:linear-gradient(135deg,#16a34a,#4ade80);
  border-radius:10px;display:flex;align-items:center;justify-content:center;
  box-shadow:0 0 18px rgba(74,222,128,.35);animation:logoPulse 3s ease-in-out infinite;}
@keyframes logoPulse{0%,100%{box-shadow:0 0 18px rgba(74,222,128,.35);}50%{box-shadow:0 0 32px rgba(74,222,128,.6),0 0 60px rgba(74,222,128,.2);}}
.qr-btn{width:38px;height:38px;border-radius:12px;background:var(--bg-glass);
  border:1px solid var(--border);display:flex;align-items:center;justify-content:center;
  cursor:pointer;backdrop-filter:blur(10px);position:relative;transition:transform .2s;}
.qr-btn:hover{transform:scale(1.08);}

/* ‚îÄ‚îÄ Greeting ‚îÄ‚îÄ */
.greeting{padding:18px 24px 0;}
.greeting .sub{font-size:13px;color:var(--text-muted);margin-bottom:3px;}
.greeting .name{font-family:'Fraunces',serif;font-size:28px;font-weight:700;
  background:linear-gradient(90deg,#4ade80,#86efac,#d4a853);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}

/* ‚îÄ‚îÄ Carbon Impact Card ‚îÄ‚îÄ */
.impact-card{margin:20px 20px 0;
  background:linear-gradient(145deg,#0d2016 0%,#0a1c12 50%,#0f2719 100%);
  border:1px solid rgba(74,222,128,.17);border-radius:28px;padding:24px 26px;
  position:relative;overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.55),0 0 0 1px rgba(74,222,128,.05) inset;}
.impact-card::before{content:'';position:absolute;top:-60px;right:-60px;width:200px;height:200px;
  background:radial-gradient(circle,rgba(34,197,94,.11) 0%,transparent 70%);
  animation:cardGlow 4s ease-in-out infinite;}
@keyframes cardGlow{0%,100%{opacity:.6;transform:scale(1);}50%{opacity:1;transform:scale(1.3);}}

.impact-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;}
.impact-left{}
.impact-label{font-size:11px;color:var(--text-muted);letter-spacing:.8px;text-transform:uppercase;margin-bottom:8px;}
.carbon-amount{font-family:'Fraunces',serif;font-size:48px;font-weight:700;
  background:linear-gradient(135deg,#f87171,#fb923c);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  line-height:1;display:flex;align-items:baseline;gap:4px;}
.carbon-amount .unit{font-size:20px;color:var(--text-muted);}

.goal-ring{width:68px;height:68px;position:relative;}
.goal-ring svg{transform:rotate(-90deg);}
.goal-ring-label{position:absolute;inset:0;display:flex;flex-direction:column;
  align-items:center;justify-content:center;font-size:13px;font-weight:700;
  color:var(--leaf-light);line-height:1;}
.goal-ring-label small{font-size:9px;color:var(--text-muted);font-weight:400;}

.goal-info{background:rgba(251,146,60,.08);border:1px solid rgba(251,146,60,.2);
  border-radius:16px;padding:12px 16px;display:flex;align-items:center;gap:12px;}
.goal-icon{font-size:24px;filter:drop-shadow(0 0 8px rgba(251,146,60,.4));}
.goal-text{flex:1;}
.goal-text .main{font-size:14px;font-weight:600;color:var(--text-pri);margin-bottom:2px;}
.goal-text .sub{font-size:11px;color:var(--text-muted);}

/* ‚îÄ‚îÄ Goal Setting Card ‚îÄ‚îÄ */
.goal-setting-card{margin:20px 20px 0;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;position:relative;overflow:hidden;}
.goal-setting-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.goal-setting-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:16px;}
.goal-setting-title{font-size:14px;font-weight:600;color:var(--text-pri);margin-bottom:4px;}
.goal-setting-subtitle{font-size:11px;color:var(--text-muted);}
.set-goal-btn{background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.25);
  border-radius:10px;padding:6px 12px;font-size:12px;font-weight:600;color:var(--leaf-light);
  cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .2s;}
.set-goal-btn:hover{background:rgba(74,222,128,.15);transform:translateY(-1px);}
.goal-display{display:flex;justify-content:space-between;align-items:center;}
.goal-amount-display{display:flex;align-items:baseline;gap:6px;}
.goal-value{font-family:'Fraunces',serif;font-size:36px;font-weight:700;color:var(--leaf-light);}
.goal-unit{font-size:14px;color:var(--text-muted);}
.green-points-badge{background:linear-gradient(135deg,rgba(251,191,36,.15),rgba(251,146,60,.1));
  border:1px solid rgba(251,191,36,.3);border-radius:14px;padding:10px 14px;display:flex;
  align-items:center;gap:10px;}
.gp-icon{font-size:24px;filter:drop-shadow(0 0 8px rgba(251,191,36,.4));}
.gp-info{text-align:right;}
.gp-value{font-size:20px;font-weight:700;color:var(--gold);line-height:1;}
.gp-label{font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.6px;margin-top:2px;}

/* ‚îÄ‚îÄ Goal Status Alert ‚îÄ‚îÄ */
.goal-status-alert{margin:16px 20px 0;border-radius:var(--r);padding:16px 18px;
  display:flex;align-items:center;transition:all .4s cubic-bezier(.4,0,.2,1);
  transform-origin:top;opacity:1;max-height:100px;}
.goal-status-alert.hidden{opacity:0;max-height:0;padding:0;margin:0;overflow:hidden;}
.goal-status-alert.success{background:linear-gradient(135deg,rgba(74,222,128,.15),rgba(34,197,94,.1));
  border:1px solid rgba(74,222,128,.3);}
.goal-status-alert.failed{background:linear-gradient(135deg,rgba(248,113,113,.15),rgba(251,146,60,.1));
  border:1px solid rgba(248,113,113,.3);}
.goal-status-content{display:flex;align-items:center;gap:12px;width:100%;}
.goal-status-icon{font-size:32px;flex-shrink:0;}
.goal-status-text{flex:1;}
.goal-status-title{font-size:15px;font-weight:700;color:var(--text-pri);margin-bottom:3px;}
.goal-status-message{font-size:12px;color:var(--text-muted);}

/* ‚îÄ‚îÄ Green Points Info Card ‚îÄ‚îÄ */
.gp-info-card{margin:16px 20px 0;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:18px;position:relative;overflow:hidden;}
.gp-info-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(251,191,36,.08) 0%,transparent 70%);}
.gp-info-header{display:flex;align-items:center;gap:10px;margin-bottom:14px;}
.gp-info-icon{font-size:20px;}
.gp-info-title{font-size:14px;font-weight:700;color:var(--text-pri);}
.gp-info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px;}
.gp-info-item{background:rgba(255,255,255,.02);border-radius:12px;padding:12px 8px;
  text-align:center;border:1px solid var(--border);transition:all .2s;}
.gp-info-item.low{border-color:rgba(74,222,128,.25);background:rgba(74,222,128,.04);}
.gp-info-item.medium{border-color:rgba(251,191,36,.25);background:rgba(251,191,36,.04);}
.gp-info-item.high{border-color:rgba(248,113,113,.25);background:rgba(248,113,113,.04);}
.gp-info-item-icon{font-size:24px;margin-bottom:6px;}
.gp-info-item-label{font-size:10px;color:var(--text-muted);margin-bottom:4px;
  text-transform:uppercase;letter-spacing:.5px;}
.gp-info-item-value{font-size:13px;font-weight:700;color:var(--text-pri);}
.gp-info-item.low .gp-info-item-value{color:var(--leaf-light);}
.gp-info-item.medium .gp-info-item-value{color:var(--gold);}
.gp-info-item.high .gp-info-item-value{color:#f87171;}
.gp-info-footer{font-size:11px;color:var(--text-muted);text-align:center;
  padding:10px;background:rgba(74,222,128,.05);border-radius:10px;
  border:1px solid rgba(74,222,128,.15);}

/* ‚îÄ‚îÄ Goal Setting Modal Input ‚îÄ‚îÄ */
.goal-input{width:100%;background:rgba(255,255,255,.03);border:1px solid var(--border);
  border-radius:12px;padding:14px 16px;font-size:18px;font-weight:600;color:var(--text-pri);
  font-family:'Fraunces',serif;text-align:center;transition:all .2s;}
.goal-input:focus{outline:none;border-color:rgba(74,222,128,.4);background:rgba(74,222,128,.05);}
.goal-suggestions{display:flex;gap:8px;margin-top:12px;}
.goal-suggest-btn{flex:1;background:rgba(255,255,255,.03);border:1px solid var(--border);
  border-radius:10px;padding:10px 8px;font-size:12px;font-weight:600;color:var(--text-muted);
  cursor:pointer;transition:all .2s;white-space:nowrap;}
.goal-suggest-btn:hover{border-color:rgba(74,222,128,.3);color:var(--leaf-light);
  background:rgba(74,222,128,.08);}

/* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
.section-title{padding:24px 24px 12px;font-size:12px;text-transform:uppercase;
  letter-spacing:1.2px;color:var(--text-muted);font-weight:500;}

/* ‚îÄ‚îÄ Transaction items ‚îÄ‚îÄ */
.txn-list{padding:0 20px;}
.txn-item{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);
  padding:16px 18px;margin-bottom:12px;display:flex;align-items:center;gap:14px;
  cursor:pointer;position:relative;overflow:hidden;transition:all .2s;}
.txn-item:hover{border-color:rgba(74,222,128,.25);box-shadow:0 6px 20px rgba(0,0,0,.3);}
.txn-icon{width:46px;height:46px;border-radius:14px;display:flex;align-items:center;
  justify-content:center;font-size:22px;flex-shrink:0;}
.txn-icon.high{background:linear-gradient(135deg,rgba(248,113,113,.15),rgba(251,146,60,.15));
  border:1px solid rgba(248,113,113,.25);}
.txn-icon.medium{background:linear-gradient(135deg,rgba(251,191,36,.15),rgba(251,146,60,.12));
  border:1px solid rgba(251,191,36,.25);}
.txn-icon.low{background:linear-gradient(135deg,rgba(74,222,128,.15),rgba(34,197,94,.12));
  border:1px solid rgba(74,222,128,.25);}
.txn-info{flex:1;min-width:0;}
.txn-name{font-size:15px;font-weight:600;color:var(--text-pri);margin-bottom:3px;}
.txn-details{font-size:12px;color:var(--text-muted);}
.txn-right{text-align:right;}
.txn-carbon{font-size:15px;font-weight:700;margin-bottom:3px;}
.txn-carbon.high{color:var(--red);}
.txn-carbon.medium{color:var(--gold);}
.txn-carbon.low{color:var(--leaf-light);}
.txn-amount{font-size:11px;color:var(--text-muted);}

/* ‚îÄ‚îÄ Bottom nav ‚îÄ‚îÄ */
.bottom-nav{
  background:rgba(5,14,8,.94);backdrop-filter:blur(24px);border-top:1px solid var(--border);
  display:flex;justify-content:space-around;align-items:center;
  padding:10px 4px 20px;flex-shrink:0;z-index:50;}
.nav-item{display:flex;flex-direction:column;align-items:center;gap:3px;
  cursor:pointer;padding:8px 14px;border-radius:14px;transition:all .25s;border:none;background:none;position:relative;}
.nav-item.active{color:var(--leaf-light);}
.nav-icon{font-size:22px;transition:transform .2s;display:flex;align-items:center;justify-content:center;}
.nav-item.active .nav-icon{transform:scale(1.15);}
.nav-label{font-size:10px;color:var(--text-muted);font-weight:600;letter-spacing:.3px;}
.nav-item.active .nav-label{color:var(--leaf-light);}

/* ‚îÄ‚îÄ Weekly Goal Card ‚îÄ‚îÄ */
.weekly-card{margin:0 20px 16px;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;position:relative;overflow:hidden;}
.weekly-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.weekly-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.weekly-title{font-size:14px;font-weight:600;color:var(--text-pri);}
.weekly-badge{background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.25);
  border-radius:8px;padding:4px 10px;font-size:11px;color:var(--leaf-light);font-weight:600;
  transition:all .3s ease;}
.weekly-progress{position:relative;height:12px;background:rgba(255,255,255,.03);
  border-radius:8px;overflow:hidden;margin-bottom:12px;}
.weekly-progress-bar{height:100%;background:linear-gradient(90deg,#4ade80,#22c55e,#16a34a);
  border-radius:8px;transition:width .6s cubic-bezier(.4,0,.2,1);position:relative;overflow:hidden;}
.weekly-progress-bar::after{content:'';position:absolute;inset:0;
  background:linear-gradient(90deg,transparent,rgba(255,255,255,.25),transparent);
  animation:shimmerBar 2s linear infinite;}
@keyframes shimmerBar{to{transform:translateX(100%);}}
.weekly-stats{display:flex;justify-content:space-between;align-items:center;}
.weekly-stat .val{font-size:18px;font-weight:700;color:var(--text-pri);}
.weekly-stat .lbl{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.6px;}
.weekly-stat.current .val{color:var(--orange);}
.weekly-stat.goal .val{color:var(--leaf-light);}

/* ‚îÄ‚îÄ Toast Notification (dark mode) ‚îÄ‚îÄ */
.toast-container{position:fixed;top:20px;left:50%;transform:translateX(-50%);
  z-index:10000;max-width:380px;width:90%;pointer-events:none;}
.toast{background:linear-gradient(135deg,rgba(11,26,15,.97),rgba(7,18,10,.97));
  backdrop-filter:blur(24px);
  border:1px solid rgba(74,222,128,.25);
  border-radius:16px;padding:14px 18px;margin-bottom:10px;
  box-shadow:0 12px 40px rgba(0,0,0,.7),0 0 0 1px rgba(74,222,128,.08) inset;
  transform:translateY(-120%);opacity:0;pointer-events:all;
  transition:all .4s cubic-bezier(.4,0,.2,1);}
.toast.show{transform:translateY(0);opacity:1;}
.toast.hide{transform:translateY(-120%);opacity:0;}
.toast-content{display:flex;align-items:center;gap:12px;}
.toast-icon{font-size:26px;flex-shrink:0;
  filter:drop-shadow(0 0 8px rgba(74,222,128,.4));}
.toast-text{flex:1;min-width:0;}
.toast-title{font-size:14px;font-weight:700;color:var(--leaf-light);margin-bottom:2px;}
.toast-message{font-size:12px;color:var(--text-muted);line-height:1.4;}
@keyframes toastSlideIn{
  0%{transform:translateY(-120%);opacity:0;}
  60%{transform:translateY(4px);}
  100%{transform:translateY(0);opacity:1;}
}
.toast.show{animation:toastSlideIn .4s cubic-bezier(.4,0,.2,1) forwards;}

/* ‚îÄ‚îÄ Modal for transaction details ‚îÄ‚îÄ */
.modal{position:fixed;inset:0;z-index:9999;display:flex;align-items:flex-end;
  background:rgba(0,0,0,.7);backdrop-filter:blur(6px);
  opacity:0;pointer-events:none;transition:opacity .3s;}
.modal.open{opacity:1;pointer-events:all;}
.modal-sheet{background:linear-gradient(145deg,#0d2016,#0a1c12);
  border-radius:28px 28px 0 0;width:100%;max-width:430px;margin:0 auto;
  max-height:85vh;overflow-y:auto;
  transform:translateY(100%);transition:transform .35s cubic-bezier(.4,0,.2,1);
  border:1px solid rgba(74,222,128,.15);box-shadow:0 -10px 60px rgba(0,0,0,.8);}
.modal.open .modal-sheet{transform:translateY(0);}
.modal-handle{width:40px;height:4px;background:rgba(255,255,255,.15);
  border-radius:2px;margin:12px auto 20px;}
.modal-content{padding:0 24px 32px;}
.modal-header{display:flex;align-items:center;gap:16px;margin-bottom:20px;}
.modal-icon-big{width:64px;height:64px;border-radius:18px;display:flex;
  align-items:center;justify-content:center;font-size:32px;flex-shrink:0;}
.modal-icon-big.high{background:linear-gradient(135deg,rgba(248,113,113,.2),rgba(251,146,60,.2));
  border:1.5px solid rgba(248,113,113,.35);}
.modal-icon-big.medium{background:linear-gradient(135deg,rgba(251,191,36,.2),rgba(251,146,60,.15));
  border:1.5px solid rgba(251,191,36,.35);}
.modal-icon-big.low{background:linear-gradient(135deg,rgba(74,222,128,.2),rgba(34,197,94,.15));
  border:1.5px solid rgba(74,222,128,.35);}
.modal-info h3{font-family:'Fraunces',serif;font-size:22px;font-weight:700;
  color:var(--text-pri);margin-bottom:4px;}
.modal-info .cat{font-size:12px;color:var(--text-muted);}
.modal-divider{height:1px;background:var(--border);margin:20px 0;}
.modal-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.modal-row .label{font-size:13px;color:var(--text-muted);}
.modal-row .value{font-size:15px;font-weight:600;color:var(--text-pri);}
.modal-row .value.carbon{color:var(--orange);font-size:18px;}
.carbon-breakdown{background:rgba(251,146,60,.06);border:1px solid rgba(251,146,60,.15);
  border-radius:16px;padding:16px;margin-bottom:20px;}
.breakdown-title{font-size:12px;color:var(--text-muted);text-transform:uppercase;
  letter-spacing:.8px;margin-bottom:12px;}
.breakdown-item{display:flex;justify-content:space-between;margin-bottom:8px;}
.breakdown-item:last-child{margin-bottom:0;}
.breakdown-item .name{font-size:13px;color:var(--text-pri);}
.breakdown-item .val{font-size:13px;font-weight:600;color:var(--orange);}
.tip-box{background:rgba(74,222,128,.06);border:1px solid rgba(74,222,128,.2);
  border-radius:16px;padding:16px;display:flex;gap:12px;}
.tip-icon{font-size:24px;flex-shrink:0;}
.tip-text{font-size:13px;color:var(--text-muted);line-height:1.5;}
.tip-text strong{color:var(--leaf-light);}
.modal-close{width:100%;background:linear-gradient(135deg,#16a34a,#22c55e);
  border:none;border-radius:16px;padding:16px;font-size:15px;font-weight:600;
  color:var(--text-pri);cursor:pointer;margin-top:20px;
  box-shadow:0 6px 20px rgba(34,197,94,.25);transition:transform .2s;}
.modal-close:hover{transform:translateY(-2px);}

/* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
@media (max-width: 380px) {
  .carbon-amount{font-size:40px;}
  .goal-ring{width:60px;height:60px;}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TRANSACTIONS PAGE STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.filter-tabs{display:flex;gap:8px;padding:12px 20px;overflow-x:auto;scrollbar-width:none;}
.filter-tabs::-webkit-scrollbar{display:none;}
.filter-tab{background:var(--bg-card);border:1px solid var(--border);border-radius:12px;
  padding:8px 16px;font-size:13px;font-weight:500;color:var(--text-muted);
  cursor:pointer;white-space:nowrap;transition:all .2s;flex-shrink:0;}
.filter-tab.active{background:rgba(74,222,128,.12);border-color:rgba(74,222,128,.3);
  color:var(--leaf-light);}
.filter-tab:hover{border-color:rgba(74,222,128,.2);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   INSIGHTS PAGE STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.insight-card{margin:20px 20px 0;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;position:relative;overflow:hidden;}
.insight-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.insight-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.insight-title{font-size:14px;font-weight:600;color:var(--text-pri);}
.insight-value{font-family:'Fraunces',serif;font-size:28px;font-weight:700;
  background:linear-gradient(135deg,#f87171,#fb923c);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.insight-chart{display:flex;gap:12px;align-items:flex-end;height:140px;}
.chart-bar{flex:1;background:rgba(255,255,255,.03);border-radius:8px;
  display:flex;align-items:flex-end;justify-content:center;padding:8px;
  position:relative;transition:all .3s;cursor:pointer;}
.chart-bar:hover{background:rgba(74,222,128,.08);}
.chart-bar.active{background:linear-gradient(180deg,rgba(248,113,113,.15),rgba(251,146,60,.1));}
.chart-bar span{font-size:10px;color:var(--text-muted);text-align:center;line-height:1.3;}

.category-list{padding:0 20px;}
.category-item{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);
  padding:16px 18px;margin-bottom:12px;display:flex;align-items:center;gap:14px;}
.cat-icon{width:46px;height:46px;border-radius:14px;display:flex;align-items:center;
  justify-content:center;font-size:22px;flex-shrink:0;
  background:rgba(74,222,128,.08);border:1px solid rgba(74,222,128,.2);}
.cat-info{flex:1;min-width:0;}
.cat-name{font-size:14px;font-weight:600;color:var(--text-pri);margin-bottom:6px;}
.cat-bar{height:6px;background:rgba(255,255,255,.03);border-radius:4px;overflow:hidden;}
.cat-bar-fill{height:100%;border-radius:4px;transition:width .6s cubic-bezier(.4,0,.2,1);}
.cat-value{text-align:right;}
.cat-carbon{font-size:15px;font-weight:700;color:var(--text-pri);margin-bottom:2px;}
.cat-percent{font-size:11px;color:var(--text-muted);}

.comparison-card{margin:0 20px 16px;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;position:relative;overflow:hidden;}
.comparison-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.comp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.comp-title{font-size:14px;font-weight:600;color:var(--text-pri);}
.comp-badge{padding:4px 12px;border-radius:8px;font-size:11px;font-weight:600;}
.comp-badge.good{background:rgba(74,222,128,.15);color:var(--leaf-light);
  border:1px solid rgba(74,222,128,.3);}
.comp-badge.bad{background:rgba(248,113,113,.15);color:#f87171;
  border:1px solid rgba(248,113,113,.3);}
.comp-bars{margin-bottom:16px;}
.comp-bar-row{display:flex;align-items:center;gap:10px;margin-bottom:12px;}
.comp-bar-row:last-child{margin-bottom:0;}
.comp-label{width:60px;font-size:13px;color:var(--text-muted);}
.comp-bar{flex:1;height:24px;background:rgba(255,255,255,.03);border-radius:8px;overflow:hidden;}
.comp-bar-fill{height:100%;border-radius:8px;transition:width .6s cubic-bezier(.4,0,.2,1);}
.comp-bar-fill.yours{background:linear-gradient(90deg,#22c55e,#4ade80);}
.comp-bar-fill.avg{background:linear-gradient(90deg,#fb923c,#fbbf24);}
.comp-val{width:60px;text-align:right;font-size:13px;font-weight:600;color:var(--text-pri);}
.comp-tip{font-size:12px;color:var(--text-muted);line-height:1.5;
  background:rgba(74,222,128,.06);border-radius:10px;padding:10px;}

.achievement-grid{padding:0 20px;display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
.achievement-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);
  padding:16px;text-align:center;position:relative;overflow:hidden;transition:all .2s;}
.achievement-card.earned{border-color:rgba(74,222,128,.3);background:rgba(74,222,128,.04);}
.achievement-card:not(.earned){opacity:.5;}
.achievement-card::before{content:'';position:absolute;top:-30px;right:-30px;width:80px;height:80px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.ach-icon{font-size:36px;margin-bottom:8px;}
.ach-name{font-size:13px;font-weight:600;color:var(--text-pri);margin-bottom:4px;}
.ach-desc{font-size:10px;color:var(--text-muted);}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROFILE PAGE STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.profile-header{margin:20px 20px 0;background:var(--bg-card);border:1px solid var(--border);
  border-radius:var(--r);padding:20px;display:flex;align-items:center;gap:16px;position:relative;overflow:hidden;}
.profile-header::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.profile-avatar{width:64px;height:64px;border-radius:18px;
  background:linear-gradient(135deg,#16a34a,#4ade80);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  box-shadow:0 0 20px rgba(74,222,128,.3);}
.profile-avatar svg{color:var(--text-pri);}
.profile-info{flex:1;min-width:0;}
.profile-name{font-size:18px;font-weight:700;color:var(--text-pri);margin-bottom:4px;}
.profile-email{font-size:12px;color:var(--text-muted);}
.edit-btn{padding:8px 16px;background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.25);
  border-radius:10px;font-size:13px;font-weight:600;color:var(--leaf-light);
  cursor:pointer;transition:all .2s;}
.edit-btn:hover{background:rgba(74,222,128,.15);transform:translateY(-1px);}

.profile-stats{padding:0 20px;margin-top:16px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;}
.stat-box{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);
  padding:16px;text-align:center;position:relative;overflow:hidden;}
.stat-box::before{content:'';position:absolute;top:-30px;right:-30px;width:80px;height:80px;
  background:radial-gradient(circle,rgba(34,197,94,.06) 0%,transparent 70%);}
.stat-icon{font-size:28px;margin-bottom:8px;}
.stat-num{font-family:'Fraunces',serif;font-size:24px;font-weight:700;color:var(--text-pri);margin-bottom:4px;}
.stat-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.6px;}

.menu-list{padding:0 20px;}
.menu-item{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--r);
  padding:16px 18px;margin-bottom:10px;display:flex;align-items:center;gap:14px;
  cursor:pointer;position:relative;overflow:hidden;transition:all .2s;}
.menu-item:hover{border-color:rgba(74,222,128,.25);box-shadow:0 4px 16px rgba(0,0,0,.25);}
.menu-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;
  justify-content:center;font-size:20px;flex-shrink:0;
  background:rgba(74,222,128,.08);border:1px solid rgba(74,222,128,.2);}
.menu-text{flex:1;min-width:0;}
.menu-title{font-size:14px;font-weight:600;color:var(--text-pri);margin-bottom:2px;}
.menu-subtitle{font-size:11px;color:var(--text-muted);}
.menu-arrow{font-size:24px;color:var(--text-muted);font-weight:300;}

.logout-btn{width:calc(100% - 40px);margin:20px 20px 0;padding:16px;
  background:rgba(248,113,113,.1);border:1px solid rgba(248,113,113,.25);
  border-radius:16px;font-size:15px;font-weight:600;color:#f87171;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;
  transition:all .2s;}
.logout-btn:hover{background:rgba(248,113,113,.15);transform:translateY(-1px);}

/* ‚îÄ‚îÄ Eco Merchants Page ‚îÄ‚îÄ */
.merchant-card{background:var(--bg-card);border:1px solid var(--border);border-radius:18px;
  padding:18px;margin-bottom:12px;position:relative;overflow:hidden;
  transition:all .3s cubic-bezier(.4,0,.2,1);cursor:pointer;}
.merchant-card:hover{transform:translateY(-2px);border-color:rgba(74,222,128,.3);
  box-shadow:0 8px 24px rgba(0,0,0,.4);}
.merchant-header{display:flex;gap:14px;margin-bottom:12px;}
.merchant-logo{width:56px;height:56px;background:linear-gradient(135deg,rgba(74,222,128,.15),rgba(34,197,94,.1));
  border:1px solid rgba(74,222,128,.2);border-radius:14px;display:flex;
  align-items:center;justify-content:center;font-size:28px;flex-shrink:0;}
.merchant-info{flex:1;}
.merchant-name{font-size:15px;font-weight:700;color:var(--text-pri);margin-bottom:4px;}
.merchant-category{font-size:10px;color:var(--text-muted);text-transform:uppercase;
  letter-spacing:.6px;margin-bottom:6px;}
.merchant-rating{display:flex;align-items:center;gap:6px;}
.stars{color:var(--gold);font-size:12px;}
.rating-count{font-size:10px;color:var(--text-muted);}
.merchant-offer{background:rgba(251,191,36,.08);border:1px solid rgba(251,191,36,.2);
  border-radius:12px;padding:10px 12px;margin-bottom:12px;}
.offer-text{font-size:12px;font-weight:600;color:var(--text-pri);margin-bottom:2px;}
.offer-desc{font-size:10px;color:var(--text-muted);}
.merchant-actions{display:flex;gap:8px;}
.merchant-btn{flex:1;padding:10px;border-radius:10px;font-size:12px;font-weight:600;
  cursor:pointer;transition:all .2s;text-align:center;}
.merchant-btn.primary{background:rgba(74,222,128,.12);border:1px solid rgba(74,222,128,.3);
  color:var(--leaf-light);}
.merchant-btn.primary:hover{background:rgba(74,222,128,.18);transform:translateY(-1px);}
.merchant-btn.secondary{background:rgba(255,255,255,.03);border:1px solid var(--border);
  color:var(--text-muted);}
.merchant-btn.secondary:hover{border-color:rgba(74,222,128,.2);color:var(--text-pri);}
.merchant-stats{display:flex;gap:12px;padding:12px;background:rgba(255,255,255,.02);
  border-radius:12px;margin-top:12px;}
.merchant-stat{flex:1;text-align:center;}
.merchant-stat-value{font-size:16px;font-weight:700;color:var(--leaf-light);display:block;}
.merchant-stat-label{font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;}

/* ‚îÄ‚îÄ Rewards Page ‚îÄ‚îÄ */
.rewards-section{margin:20px 20px 0;}
.section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;padding:0 4px;}
.view-all-btn{font-size:12px;color:var(--leaf-light);font-weight:600;cursor:pointer;
  display:flex;align-items:center;gap:4px;transition:transform .2s;}
.view-all-btn:hover{transform:translateX(2px);}
.rewards-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.reward-card{background:var(--bg-card);border:1px solid var(--border);border-radius:16px;
  padding:16px;position:relative;overflow:hidden;cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);}
.reward-card:hover{transform:translateY(-4px);border-color:rgba(74,222,128,.3);
  box-shadow:0 8px 24px rgba(0,0,0,.4);}
.reward-card.locked{opacity:.6;}
.reward-card.locked::after{content:'üîí';position:absolute;top:12px;right:12px;font-size:16px;opacity:.5;}
.reward-icon{font-size:32px;margin-bottom:8px;display:block;filter:drop-shadow(0 0 8px rgba(74,222,128,.3));}
.reward-title{font-size:13px;font-weight:600;color:var(--text-pri);margin-bottom:4px;}
.reward-desc{font-size:10px;color:var(--text-muted);margin-bottom:8px;line-height:1.4;}
.reward-cost{display:inline-flex;align-items:center;gap:4px;background:rgba(251,191,36,.12);
  border:1px solid rgba(251,191,36,.25);border-radius:8px;padding:4px 8px;font-size:11px;
  font-weight:700;color:var(--gold);}

/* ‚îÄ‚îÄ Investment Cards ‚îÄ‚îÄ */
.investment-card{background:linear-gradient(145deg,rgba(74,222,128,.08),rgba(34,197,94,.05));
  border:1px solid rgba(74,222,128,.2);border-radius:18px;padding:20px;
  margin-bottom:14px;position:relative;overflow:hidden;cursor:pointer;
  transition:all .3s cubic-bezier(.4,0,.2,1);}
.investment-card:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,.4);}
.investment-card::before{content:'';position:absolute;top:-40px;right:-40px;width:120px;height:120px;
  background:radial-gradient(circle,rgba(74,222,128,.1) 0%,transparent 70%);}
.investment-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:14px;}
.investment-title{font-size:16px;font-weight:700;color:var(--text-pri);margin-bottom:4px;}
.investment-subtitle{font-size:11px;color:var(--text-muted);}
.investment-badge{background:rgba(251,191,36,.15);border:1px solid rgba(251,191,36,.3);
  border-radius:10px;padding:6px 10px;font-size:11px;font-weight:700;color:var(--gold);
  white-space:nowrap;flex-shrink:0;}
.investment-details{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:14px;}
.investment-detail{background:rgba(0,0,0,.2);border-radius:10px;padding:10px;text-align:center;}
.investment-detail-label{font-size:9px;color:var(--text-muted);text-transform:uppercase;
  letter-spacing:.5px;margin-bottom:4px;}
.investment-detail-value{font-size:15px;font-weight:700;color:var(--leaf-light);}
.investment-cta{background:rgba(74,222,128,.15);border:1px solid rgba(74,222,128,.35);
  border-radius:12px;padding:12px;text-align:center;cursor:pointer;transition:all .2s;}
.investment-cta:hover{background:rgba(74,222,128,.22);transform:translateY(-2px);}
.investment-cta-text{font-size:13px;font-weight:700;color:var(--leaf-light);}

/* ‚îÄ‚îÄ Detail Modal ‚îÄ‚îÄ */
.detail-modal{position:fixed;inset:0;background:rgba(0,0,0,.9);backdrop-filter:blur(10px);
  z-index:3000;display:flex;align-items:center;justify-content:center;padding:20px;
  opacity:0;pointer-events:none;transition:opacity .3s cubic-bezier(.4,0,.2,1);}
.detail-modal.open{opacity:1;pointer-events:all;}
.detail-modal-content{background:var(--bg-card);border:1px solid var(--border);
  border-radius:24px;width:100%;max-width:400px;max-height:80vh;overflow-y:auto;
  padding:24px;transform:scale(.9);transition:transform .3s cubic-bezier(.4,0,.2,1);}
.detail-modal.open .detail-modal-content{transform:scale(1);}
.detail-modal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:20px;}
.detail-modal-icon{font-size:48px;margin-bottom:12px;}
.detail-modal-title{font-size:20px;font-weight:700;color:var(--text-pri);margin-bottom:6px;}
.detail-modal-subtitle{font-size:13px;color:var(--text-muted);margin-bottom:16px;}
.detail-modal-close{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.05);
  display:flex;align-items:center;justify-content:center;cursor:pointer;
  font-size:20px;color:var(--text-muted);transition:all .2s;flex-shrink:0;}
.detail-modal-close:hover{background:rgba(255,255,255,.1);transform:rotate(90deg);}
.detail-section{margin-bottom:20px;}
.detail-section-title{font-size:12px;color:var(--text-muted);text-transform:uppercase;
  letter-spacing:.8px;margin-bottom:10px;font-weight:600;}
.detail-section-content{font-size:14px;color:var(--text-pri);line-height:1.6;}
.detail-feature-list{display:flex;flex-direction:column;gap:8px;}
.detail-feature{display:flex;align-items:flex-start;gap:8px;padding:8px;
  background:rgba(74,222,128,.05);border-radius:10px;}
.detail-feature-icon{flex-shrink:0;font-size:18px;}
.detail-feature-text{font-size:13px;color:var(--text-pri);}
.detail-stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-bottom:16px;}
.detail-stat{background:rgba(255,255,255,.03);border-radius:12px;padding:12px;text-align:center;}
.detail-stat-value{font-size:18px;font-weight:700;color:var(--leaf-light);display:block;margin-bottom:4px;}
.detail-stat-label{font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;}
.detail-actions{display:flex;gap:10px;margin-top:4px;}
.detail-btn{flex:1;padding:14px;border-radius:12px;font-size:14px;font-weight:600;
  cursor:pointer;transition:all .2s;text-align:center;}
.detail-btn.primary{background:rgba(74,222,128,.15);border:1px solid rgba(74,222,128,.35);
  color:var(--leaf-light);}
.detail-btn.primary:hover{background:rgba(74,222,128,.22);transform:translateY(-2px);}
.detail-btn.primary.disabled{opacity:.4;cursor:not-allowed;}
.detail-btn.primary.disabled:hover{transform:none;}
.detail-btn.secondary{background:rgba(255,255,255,.03);border:1px solid var(--border);
  color:var(--text-muted);}
.detail-btn.secondary:hover{border-color:rgba(74,222,128,.2);}
.claimed-badge{background:rgba(251,191,36,.15);border:1px solid rgba(251,191,36,.3);
  border-radius:12px;padding:10px 16px;text-align:center;margin-bottom:16px;}
.claimed-badge-text{font-size:13px;font-weight:600;color:var(--gold);}

/* ‚îÄ‚îÄ Points animation ‚îÄ‚îÄ */
@keyframes pointsEarned{
  0%{transform:translateY(0) scale(1);opacity:1;}
  100%{transform:translateY(-100px) scale(1.5);opacity:0;}
}
.points-floating{position:fixed;font-size:24px;font-weight:800;color:var(--gold);
  pointer-events:none;z-index:9999;
  animation:pointsEarned 1.5s cubic-bezier(.4,0,.2,1) forwards;
  filter:drop-shadow(0 0 12px rgba(251,191,36,.6));}

/* ‚îÄ‚îÄ Page bottom padding ‚îÄ‚îÄ */
.page{padding-bottom:90px;}
</style>
</head>
<body>

<!-- Carbon particles background -->
<div class="carbon-field" id="carbonField"></div>

<div class="app">
  <div class="pages">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         HOME PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page active" id="homePage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üå±</div>
          CarbonCash
        </div>
        <button class="qr-btn" id="qrBtn" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">Track Your Impact</div>
        <div class="name">Carbon Footprint</div>
      </div>

      <!-- Goal Setting & Green Points -->
      <div class="goal-setting-card">
        <div class="goal-setting-header">
          <div class="goal-setting-left">
            <div class="goal-setting-title">Weekly Carbon Goal</div>
            <div class="goal-setting-subtitle">Set your target and earn points</div>
          </div>
          <button class="set-goal-btn" id="setGoalBtn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
            Edit
          </button>
        </div>
        <div class="goal-display">
          <div class="goal-amount-display">
            <span class="goal-value" id="goalValue">8.0</span>
            <span class="goal-unit">kg CO‚ÇÇ</span>
          </div>
          <div class="green-points-badge">
            <div class="gp-icon">üåü</div>
            <div class="gp-info">
              <div class="gp-value" id="greenPoints">0</div>
              <div class="gp-label">Green Points</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Goal Status Alert -->
      <div class="goal-status-alert hidden" id="goalStatusAlert">
        <div class="goal-status-content">
          <div class="goal-status-icon" id="goalStatusIcon">üéâ</div>
          <div class="goal-status-text">
            <div class="goal-status-title" id="goalStatusTitle">Goal Achieved!</div>
            <div class="goal-status-message" id="goalStatusMessage">You earned 50 Green Points</div>
          </div>
        </div>
      </div>

      <!-- Carbon Impact Card -->
      <div class="impact-card">
        <div class="impact-header">
          <div class="impact-left">
            <div class="impact-label">This Week's Carbon</div>
            <div class="carbon-amount">
              <span id="weekCarbon">0.0</span>
              <span class="unit">kg CO‚ÇÇ</span>
            </div>
          </div>
          <div class="goal-ring">
            <svg width="68" height="68" viewBox="0 0 68 68">
              <circle cx="34" cy="34" r="30" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="6"/>
              <circle id="goalCircle" cx="34" cy="34" r="30" fill="none" stroke="url(#goalGradient)" stroke-width="6"
                stroke-dasharray="188.5" stroke-dashoffset="188.5" stroke-linecap="round"/>
              <defs>
                <linearGradient id="goalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#f87171"/>
                  <stop offset="50%" style="stop-color:#fb923c"/>
                  <stop offset="100%" style="stop-color:#fbbf24"/>
                </linearGradient>
              </defs>
            </svg>
            <div class="goal-ring-label">
              <span>0%</span>
              <small>of goal</small>
            </div>
          </div>
        </div>
        <div class="goal-info">
          <div class="goal-icon">üéØ</div>
          <div class="goal-text">
            <div class="main">8.0 kg away from your Green Goal</div>
            <div class="sub">Weekly target: 8kg CO‚ÇÇ</div>
          </div>
        </div>
      </div>

      <!-- Weekly Goal Progress -->
      <div class="weekly-card" style="margin-top: 24px;">
        <div class="weekly-header">
          <div class="weekly-title">Remaining Budget</div>
          <div class="weekly-badge" id="weeklyBadge">On Track</div>
        </div>
        <div class="weekly-progress">
          <div class="weekly-progress-bar" id="weeklyProgressBar" style="width: 100%;"></div>
        </div>
        <div class="weekly-stats">
          <div class="weekly-stat">
            <div class="val" id="weeklyRemaining">8.0 kg</div>
            <div class="lbl">Remaining</div>
          </div>
          <div class="weekly-stat current">
            <div class="val" id="weeklyUsed">0.0 kg</div>
            <div class="lbl">Used</div>
          </div>
          <div class="weekly-stat goal">
            <div class="val" id="weeklyGoalDisplay">8.0 kg</div>
            <div class="lbl">Goal</div>
          </div>
        </div>
      </div>

      <!-- Green Points Info Card -->
      <div class="gp-info-card">
        <div class="gp-info-header">
          <div class="gp-info-icon">üí°</div>
          <div class="gp-info-title">How Green Points Work</div>
        </div>
        <div class="gp-info-grid">
          <div class="gp-info-item low">
            <div class="gp-info-item-icon">üå±</div>
            <div class="gp-info-item-label">Low Impact</div>
            <div class="gp-info-item-value">+6 GP/‚Çπ100</div>
          </div>
          <div class="gp-info-item medium">
            <div class="gp-info-item-icon">‚öñÔ∏è</div>
            <div class="gp-info-item-label">Medium Impact</div>
            <div class="gp-info-item-value">+2 GP/‚Çπ100</div>
          </div>
          <div class="gp-info-item high">
            <div class="gp-info-item-icon">üî•</div>
            <div class="gp-info-item-label">High Impact</div>
            <div class="gp-info-item-value">-4 GP/‚Çπ100</div>
          </div>
        </div>
        <div class="gp-info-footer">Choose eco-friendly purchases to maximize your Green Points!</div>
      </div>

      <!-- Recent Transactions -->
      <div class="section-title">Recent Transactions</div>
      <div class="txn-list" id="homeTxnList">
        <div id="homeEmptyState" style="text-align:center;padding:40px 20px;color:var(--text-muted);">
          <div style="font-size:48px;margin-bottom:12px;">üì±</div>
          <div style="font-size:14px;margin-bottom:4px;">No transactions yet</div>
          <div style="font-size:12px;">Tap the QR button to simulate a purchase</div>
        </div>
      </div>
      <div style="height:20px;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         TRANSACTIONS PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="transactionsPage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üå±</div>
          CarbonCash
        </div>
        <button class="qr-btn" id="qrBtn2" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">All Your Purchases</div>
        <div class="name">Transactions</div>
      </div>

      <!-- Filter tabs -->
      <div class="filter-tabs">
        <button class="filter-tab active" data-filter="all">All</button>
        <button class="filter-tab" data-filter="high">High Impact</button>
        <button class="filter-tab" data-filter="medium">Medium</button>
        <button class="filter-tab" data-filter="low">Low Impact</button>
      </div>

      <div class="section-title">This Week</div>
      <div class="txn-list" id="transactionsTxnList">
        <div id="txnsEmptyState" style="text-align:center;padding:40px 20px;color:var(--text-muted);">
          <div style="font-size:48px;margin-bottom:12px;">üì±</div>
          <div style="font-size:14px;margin-bottom:4px;">No transactions yet</div>
          <div style="font-size:12px;">Tap the QR button to simulate a purchase</div>
        </div>
      </div>
      <div style="height:20px;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         INSIGHTS PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="insightsPage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üå±</div>
          CarbonCash
        </div>
        <button class="qr-btn" id="qrBtn3" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">Environmental Analytics</div>
        <div class="name">Insights</div>
      </div>

      <!-- Monthly Overview -->
      <div class="insight-card">
        <div class="insight-header">
          <div class="insight-title">Weekly Carbon Footprint</div>
          <div class="insight-value" id="insightsWeeklyTotal">0 kg CO‚ÇÇ</div>
        </div>
        <div class="insight-chart" id="weeklyChart">
          <div style="text-align:center;padding:40px 20px;color:var(--text-muted);">
            <div style="font-size:36px;margin-bottom:8px;">üìä</div>
            <div style="font-size:13px;">No transactions yet ‚Äî tap üì∑ to add one</div>
          </div>
        </div>
      </div>

      <!-- Category Breakdown -->
      <div class="section-title">Carbon by Category</div>
      <div class="category-list" id="categoryList">
        <div style="text-align:center;padding:32px 20px;color:var(--text-muted);">
          <div style="font-size:36px;margin-bottom:8px;">üìä</div>
          <div style="font-size:13px;">No transactions yet ‚Äî tap üì∑ to add one</div>
        </div>
      </div>

      <!-- Comparison Card -->
      <div class="section-title">Your Impact</div>
      <div class="comparison-card" id="comparisonCard">
        <div class="comp-header">
          <div class="comp-title">vs Average User</div>
          <div class="comp-badge good" id="compBadge">-% Better</div>
        </div>
        <div class="comp-bars">
          <div class="comp-bar-row">
            <div class="comp-label">You</div>
            <div class="comp-bar"><div class="comp-bar-fill yours" style="width:0%;" id="yourBar"></div></div>
            <div class="comp-val" id="yourCarbon">0 kg</div>
          </div>
          <div class="comp-bar-row">
            <div class="comp-label">Average</div>
            <div class="comp-bar"><div class="comp-bar-fill avg" style="width:100%;"></div></div>
            <div class="comp-val" id="avgCarbon">8.0 kg</div>
          </div>
        </div>
        <div class="comp-tip" id="compTip">üåü Start adding transactions to see how you compare!</div>
      </div>

      <!-- Achievements -->
      <div class="section-title">Achievements</div>
      <div class="achievement-grid">
        <div class="achievement-card" id="achEcoStarter">
          <div class="ach-icon">üå±</div>
          <div class="ach-name">Eco Starter</div>
          <div class="ach-desc">First transaction tracked</div>
        </div>
        <div class="achievement-card" id="achGoalGetter">
          <div class="ach-icon">üéØ</div>
          <div class="ach-name">Goal Getter</div>
          <div class="ach-desc">Met weekly goal</div>
        </div>
        <div class="achievement-card" id="achSpendWise">
          <div class="ach-icon">üí∞</div>
          <div class="ach-name">Spend Wise</div>
          <div class="ach-desc">5+ transactions tracked</div>
        </div>
        <div class="achievement-card" id="achPointCollector">
          <div class="ach-icon">‚≠ê</div>
          <div class="ach-name">Point Collector</div>
          <div class="ach-desc">Earned 50+ GP</div>
        </div>
      </div>
      <div style="height:20px;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         PROFILE PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="profilePage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üå±</div>
          CarbonCash
        </div>
        <button class="qr-btn" id="qrBtn4" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">Your Account</div>
        <div class="name">Profile</div>
      </div>

      <div class="profile-header">
        <div class="profile-avatar">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
          </svg>
        </div>
        <div class="profile-info">
          <div class="profile-name">Priya Sharma</div>
          <div class="profile-email"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5a2a2833233b1a393b28383534393b2932743334">[email&#160;protected]</a></div>
        </div>
        <button class="edit-btn" id="editProfileBtn">Edit</button>
      </div>

      <div class="profile-stats">
        <div class="stat-box">
          <div class="stat-icon">üå±</div>
          <div class="stat-num" id="profileTotalCarbon">0</div>
          <div class="stat-label">Total CO‚ÇÇ (kg)</div>
        </div>
        <div class="stat-box">
          <div class="stat-icon">üéØ</div>
          <div class="stat-num">12</div>
          <div class="stat-label">Goals Met</div>
        </div>
        <div class="stat-box">
          <div class="stat-icon">üèÜ</div>
          <div class="stat-num">8</div>
          <div class="stat-label">Achievements</div>
        </div>
      </div>

      <div class="section-title">Settings</div>
      <div class="menu-list">
        <div class="menu-item"><div class="menu-icon">üéØ</div><div class="menu-text"><div class="menu-title">Carbon Goals</div><div class="menu-subtitle">Set your weekly targets</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üîî</div><div class="menu-text"><div class="menu-title">Notifications</div><div class="menu-subtitle">Manage alerts & reminders</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üîó</div><div class="menu-text"><div class="menu-title">Linked Accounts</div><div class="menu-subtitle">3 cards connected</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üåç</div><div class="menu-text"><div class="menu-title">Offset Programs</div><div class="menu-subtitle">Plant trees & support projects</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üìä</div><div class="menu-text"><div class="menu-title">Export Data</div><div class="menu-subtitle">Download your carbon history</div></div><div class="menu-arrow">‚Ä∫</div></div>
      </div>

      <div class="section-title">Support</div>
      <div class="menu-list">
        <div class="menu-item"><div class="menu-icon">‚ùì</div><div class="menu-text"><div class="menu-title">Help & FAQ</div><div class="menu-subtitle">Get answers to common questions</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üí¨</div><div class="menu-text"><div class="menu-title">Contact Support</div><div class="menu-subtitle">We're here to help</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">‚≠ê</div><div class="menu-text"><div class="menu-title">Rate CarbonCash</div><div class="menu-subtitle">Share your feedback</div></div><div class="menu-arrow">‚Ä∫</div></div>
      </div>

      <div class="section-title">Legal</div>
      <div class="menu-list">
        <div class="menu-item"><div class="menu-icon">üìÑ</div><div class="menu-text"><div class="menu-title">Privacy Policy</div></div><div class="menu-arrow">‚Ä∫</div></div>
        <div class="menu-item"><div class="menu-icon">üìã</div><div class="menu-text"><div class="menu-title">Terms of Service</div></div><div class="menu-arrow">‚Ä∫</div></div>
      </div>

      <button class="logout-btn" id="logoutBtn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"/>
        </svg>
        Log Out
      </button>
      <div style="height:20px;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         ECO MERCHANTS PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="merchantsPage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üè™</div>
          Eco Merchants
        </div>
        <button class="qr-btn" id="qrBtn3" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">Discover sustainable partners</div>
        <div class="name" style="font-size:22px;">Earn rewards for green purchases</div>
      </div>

      <div class="section-title">Featured Merchants</div>
      <div style="padding:0 20px;">

        <div class="merchant-card" onclick="showMerchantDetail('solar')">
          <div class="merchant-header">
            <div class="merchant-logo">‚òÄÔ∏è</div>
            <div class="merchant-info">
              <div class="merchant-name">SolarPro Solutions</div>
              <div class="merchant-category">Renewable Energy</div>
              <div class="merchant-rating"><span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span><span class="rating-count">(2.4k)</span></div>
            </div>
          </div>
          <div class="merchant-offer">
            <div class="offer-text">üéÅ Earn 30 GP per ‚Çπ100 spent</div>
            <div class="offer-desc">Plus 15% discount with 200+ GP</div>
          </div>
          <div class="merchant-stats">
            <div class="merchant-stat"><span class="merchant-stat-value">30</span><span class="merchant-stat-label">GP/Purchase</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">15%</span><span class="merchant-stat-label">Max Discount</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">4.8k</span><span class="merchant-stat-label">Users</span></div>
          </div>
          <div class="merchant-actions">
            <div class="merchant-btn primary" onclick="event.stopPropagation(); visitMerchant('solar')">Visit Store</div>
            <div class="merchant-btn secondary" onclick="event.stopPropagation(); saveMerchant('SolarPro Solutions')">üíö Save</div>
          </div>
        </div>

        <div class="merchant-card" onclick="showMerchantDetail('ev')">
          <div class="merchant-header">
            <div class="merchant-logo">‚ö°</div>
            <div class="merchant-info">
              <div class="merchant-name">EcoCharge Network</div>
              <div class="merchant-category">EV Charging</div>
              <div class="merchant-rating"><span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span><span class="rating-count">(1.8k)</span></div>
            </div>
          </div>
          <div class="merchant-offer">
            <div class="offer-text">üéÅ Earn 5 GP per charge session</div>
            <div class="offer-desc">Free charging with 150+ GP</div>
          </div>
          <div class="merchant-stats">
            <div class="merchant-stat"><span class="merchant-stat-value">5</span><span class="merchant-stat-label">GP/Session</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">100%</span><span class="merchant-stat-label">Free Charge</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">2.1k</span><span class="merchant-stat-label">Stations</span></div>
          </div>
          <div class="merchant-actions">
            <div class="merchant-btn primary" onclick="event.stopPropagation(); visitMerchant('ev')">Find Station</div>
            <div class="merchant-btn secondary" onclick="event.stopPropagation(); saveMerchant('EcoCharge Network')">üíö Save</div>
          </div>
        </div>

        <div class="merchant-card" onclick="showMerchantDetail('grocer')">
          <div class="merchant-header">
            <div class="merchant-logo">üåø</div>
            <div class="merchant-info">
              <div class="merchant-name">GreenGrocer Market</div>
              <div class="merchant-category">Organic Food</div>
              <div class="merchant-rating"><span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span><span class="rating-count">(3.2k)</span></div>
            </div>
          </div>
          <div class="merchant-offer">
            <div class="offer-text">üéÅ Earn 2 GP per ‚Çπ10 spent</div>
            <div class="offer-desc">10% discount on organic produce with 100+ GP</div>
          </div>
          <div class="merchant-stats">
            <div class="merchant-stat"><span class="merchant-stat-value">20</span><span class="merchant-stat-label">GP/Week Avg</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">10%</span><span class="merchant-stat-label">Discount</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">45</span><span class="merchant-stat-label">Locations</span></div>
          </div>
          <div class="merchant-actions">
            <div class="merchant-btn primary" onclick="event.stopPropagation(); visitMerchant('grocer')">Shop Now</div>
            <div class="merchant-btn secondary" onclick="event.stopPropagation(); saveMerchant('GreenGrocer Market')">üíö Save</div>
          </div>
        </div>

        <div class="merchant-card" onclick="showMerchantDetail('bike')">
          <div class="merchant-header">
            <div class="merchant-logo">üö¥</div>
            <div class="merchant-info">
              <div class="merchant-name">BikeShare City</div>
              <div class="merchant-category">Green Transport</div>
              <div class="merchant-rating"><span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span><span class="rating-count">(5.1k)</span></div>
            </div>
          </div>
          <div class="merchant-offer">
            <div class="offer-text">üéÅ Earn 3 GP per ride</div>
            <div class="offer-desc">Monthly pass discount with 80+ GP</div>
          </div>
          <div class="merchant-stats">
            <div class="merchant-stat"><span class="merchant-stat-value">3</span><span class="merchant-stat-label">GP/Ride</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">20%</span><span class="merchant-stat-label">Pass Discount</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">300+</span><span class="merchant-stat-label">Stations</span></div>
          </div>
          <div class="merchant-actions">
            <div class="merchant-btn primary" onclick="event.stopPropagation(); visitMerchant('bike')">Find Bike</div>
            <div class="merchant-btn secondary" onclick="event.stopPropagation(); saveMerchant('BikeShare City')">üíö Save</div>
          </div>
        </div>

        <div class="merchant-card" onclick="showMerchantDetail('recycle')">
          <div class="merchant-header">
            <div class="merchant-logo">‚ôªÔ∏è</div>
            <div class="merchant-info">
              <div class="merchant-name">RecycleHub</div>
              <div class="merchant-category">Waste Management</div>
              <div class="merchant-rating"><span class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span><span class="rating-count">(4.3k)</span></div>
            </div>
          </div>
          <div class="merchant-offer">
            <div class="offer-text">üéÅ Earn 10 GP per recycling drop-off</div>
            <div class="offer-desc">Bonus rewards for electronics recycling</div>
          </div>
          <div class="merchant-stats">
            <div class="merchant-stat"><span class="merchant-stat-value">10</span><span class="merchant-stat-label">GP/Drop-off</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">50</span><span class="merchant-stat-label">Bonus GP</span></div>
            <div class="merchant-stat"><span class="merchant-stat-value">120</span><span class="merchant-stat-label">Centers</span></div>
          </div>
          <div class="merchant-actions">
            <div class="merchant-btn primary" onclick="event.stopPropagation(); visitMerchant('recycle')">Find Center</div>
            <div class="merchant-btn secondary" onclick="event.stopPropagation(); saveMerchant('RecycleHub')">üíö Save</div>
          </div>
        </div>

      </div>
      <div style="height:20px;"></div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         REWARDS PAGE
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="page" id="rewardsPage">
      <div class="header">
        <div class="logo">
          <div class="logo-icon">üéÅ</div>
          Rewards
        </div>
        <button class="qr-btn" id="qrBtn4" title="Scan QR Code">üì∑</button>
      </div>

      <div class="greeting">
        <div class="sub">Your Green Points</div>
        <div class="name" style="font-size:32px;"><span id="rewardsGP">0</span> GP</div>
      </div>

      <div class="section-title">Green Investment Discounts</div>
      <div style="padding:0 20px;">

        <div class="investment-card" onclick="showInvestmentDetail('solar', 100)">
          <div class="investment-header">
            <div><div class="investment-title">Solar Panel Installation</div><div class="investment-subtitle">Clean energy for your home</div></div>
            <div class="investment-badge">üî• Popular</div>
          </div>
          <div class="investment-details">
            <div class="investment-detail"><div class="investment-detail-label">Cost</div><div class="investment-detail-value">100 GP</div></div>
            <div class="investment-detail"><div class="investment-detail-label">You Save</div><div class="investment-detail-value">10%</div></div>
          </div>
          <div class="investment-cta" onclick="event.stopPropagation(); showInvestmentDetail('solar', 100)"><div class="investment-cta-text">Redeem Discount ‚Üí</div></div>
        </div>

        <div class="investment-card" onclick="showInvestmentDetail('ev-charging', 150)">
          <div class="investment-header">
            <div><div class="investment-title">EV Charging Station</div><div class="investment-subtitle">Home charging solution</div></div>
            <div class="investment-badge">‚ö° New</div>
          </div>
          <div class="investment-details">
            <div class="investment-detail"><div class="investment-detail-label">Cost</div><div class="investment-detail-value">150 GP</div></div>
            <div class="investment-detail"><div class="investment-detail-label">You Save</div><div class="investment-detail-value">15%</div></div>
          </div>
          <div class="investment-cta" onclick="event.stopPropagation(); showInvestmentDetail('ev-charging', 150)"><div class="investment-cta-text">Redeem Discount ‚Üí</div></div>
        </div>

        <div class="investment-card" onclick="showInvestmentDetail('wind-energy', 200)">
          <div class="investment-header">
            <div><div class="investment-title">Wind Energy Subscription</div><div class="investment-subtitle">100% renewable electricity</div></div>
            <div class="investment-badge">üíö Eco</div>
          </div>
          <div class="investment-details">
            <div class="investment-detail"><div class="investment-detail-label">Cost</div><div class="investment-detail-value">200 GP</div></div>
            <div class="investment-detail"><div class="investment-detail-label">You Save</div><div class="investment-detail-value">20%</div></div>
          </div>
          <div class="investment-cta" onclick="event.stopPropagation(); showInvestmentDetail('wind-energy', 200)"><div class="investment-cta-text">Redeem Discount ‚Üí</div></div>
        </div>

        <div class="investment-card" onclick="showInvestmentDetail('green-bonds', 300)">
          <div class="investment-header">
            <div><div class="investment-title">Green Bond Investment</div><div class="investment-subtitle">Support eco projects</div></div>
            <div class="investment-badge">üìà Premium</div>
          </div>
          <div class="investment-details">
            <div class="investment-detail"><div class="investment-detail-label">Cost</div><div class="investment-detail-value">300 GP</div></div>
            <div class="investment-detail"><div class="investment-detail-label">Bonus APY</div><div class="investment-detail-value">+2%</div></div>
          </div>
          <div class="investment-cta" onclick="event.stopPropagation(); showInvestmentDetail('green-bonds', 300)"><div class="investment-cta-text">Redeem Bonus ‚Üí</div></div>
        </div>

        <div class="investment-card" onclick="showInvestmentDetail('carbon-offset', 80)">
          <div class="investment-header">
            <div><div class="investment-title">Carbon Offset Credits</div><div class="investment-subtitle">Neutralize your footprint</div></div>
            <div class="investment-badge">üåç Impact</div>
          </div>
          <div class="investment-details">
            <div class="investment-detail"><div class="investment-detail-label">Cost</div><div class="investment-detail-value">80 GP</div></div>
            <div class="investment-detail"><div class="investment-detail-label">Credits</div><div class="investment-detail-value">5 tons</div></div>
          </div>
          <div class="investment-cta" onclick="event.stopPropagation(); showInvestmentDetail('carbon-offset', 80)"><div class="investment-cta-text">Purchase Credits ‚Üí</div></div>
        </div>

      </div>

      <div class="section-title" style="margin-top:8px;">Lifestyle Rewards</div>
      <div style="padding:0 20px;">
        <div class="rewards-grid">
          <div class="reward-card" onclick="showRewardDetail('coffee', 25)">
            <span class="reward-icon">‚òï</span>
            <div class="reward-title">Coffee Voucher</div>
            <div class="reward-desc">‚Çπ400 at eco-friendly caf√©s</div>
            <span class="reward-cost">üí∞ 25 GP</span>
          </div>
          <div class="reward-card" onclick="showRewardDetail('bike-rental', 40)">
            <span class="reward-icon">üö≤</span>
            <div class="reward-title">Bike Rental</div>
            <div class="reward-desc">1 week free rental</div>
            <span class="reward-cost">üí∞ 40 GP</span>
          </div>
          <div class="reward-card" onclick="showRewardDetail('transit', 120)">
            <span class="reward-icon">üöá</span>
            <div class="reward-title">Transit Pass</div>
            <div class="reward-desc">1 month unlimited rides</div>
            <span class="reward-cost">üí∞ 120 GP</span>
          </div>
          <div class="reward-card" onclick="showRewardDetail('organic', 60)">
            <span class="reward-icon">ü•ó</span>
            <div class="reward-title">Organic Box</div>
            <div class="reward-desc">Fresh organic produce</div>
            <span class="reward-cost">üí∞ 60 GP</span>
          </div>
        </div>
      </div>
      <div style="height:20px;"></div>
    </div>

  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <button class="nav-item active" data-page="homePage">
      <div class="nav-icon">üè†</div>
      <div class="nav-label">Home</div>
    </button>
    <button class="nav-item" data-page="transactionsPage">
      <div class="nav-icon">üí≥</div>
      <div class="nav-label">Activity</div>
    </button>
    <button class="nav-item" data-page="merchantsPage">
      <div class="nav-icon">üè™</div>
      <div class="nav-label">Merchants</div>
    </button>
    <button class="nav-item" data-page="rewardsPage">
      <div class="nav-icon">üéÅ</div>
      <div class="nav-label">Rewards</div>
    </button>
    <button class="nav-item" data-page="insightsPage">
      <div class="nav-icon">üìä</div>
      <div class="nav-label">Insights</div>
    </button>
    <button class="nav-item" data-page="profilePage">
      <div class="nav-icon">üë§</div>
      <div class="nav-label">Profile</div>
    </button>
  </div>
</div>

<!-- Toast Notification Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Detail Info Modal -->
<div class="detail-modal" id="detailModal">
  <div class="detail-modal-content">
    <div class="detail-modal-header">
      <div style="flex:1;">
        <div class="detail-modal-icon" id="detailIcon">‚òÄÔ∏è</div>
        <div class="detail-modal-title" id="detailTitle">Title</div>
        <div class="detail-modal-subtitle" id="detailSubtitle">Subtitle</div>
      </div>
      <div class="detail-modal-close" onclick="closeDetailModal()">‚úï</div>
    </div>
    <div id="detailClaimedBadge" class="claimed-badge" style="display:none;">
      <div class="claimed-badge-text">‚úì Already Claimed</div>
    </div>
    <div id="detailStatsSection" class="detail-stats" style="display:none;"></div>
    <div class="detail-section">
      <div class="detail-section-title">Description</div>
      <div class="detail-section-content" id="detailDescription"></div>
    </div>
    <div class="detail-section" id="detailFeaturesSection" style="display:none;">
      <div class="detail-section-title">Features & Benefits</div>
      <div class="detail-feature-list" id="detailFeatures"></div>
    </div>
    <div class="detail-section" id="detailTermsSection" style="display:none;">
      <div class="detail-section-title">Terms & Conditions</div>
      <div class="detail-section-content" id="detailTerms"></div>
    </div>
    <div class="detail-actions" id="detailActions"></div>
  </div>
</div>

<!-- Transaction Detail Modal -->
<div class="modal" id="txnModal">
  <div class="modal-sheet" id="txnModalSheet">
    <div class="modal-handle"></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-icon-big high" id="modalIconBig">
          <span id="modalEmoji">‚òï</span>
        </div>
        <div class="modal-info">
          <h3 id="modalName">Starbucks Coffee</h3>
          <div class="cat" id="modalCat">Eating Places ¬∑ MCC 5812</div>
        </div>
      </div>

      <div class="modal-row">
        <div class="label">Transaction Amount</div>
        <div class="value" id="modalAmount">‚Çπ450</div>
      </div>
      <div class="modal-row">
        <div class="label">Carbon Footprint</div>
        <div class="value carbon" id="modalCarbon">0.8 kg CO‚ÇÇ</div>
      </div>
      <div class="modal-row">
        <div class="label">Transaction Date</div>
        <div class="value" id="modalDate">Feb 14, 2026 ¬∑ 2:34 PM</div>
      </div>

      <div class="modal-divider"></div>

      <div class="carbon-breakdown" id="carbonBreakdown">
        <div class="breakdown-title">Carbon Breakdown</div>
      </div>

      <div class="tip-box">
        <div class="tip-icon">üí°</div>
        <div class="tip-text" id="modalTip">
          <strong>Eco Tip:</strong> Small choices add up. Consider greener alternatives to reduce your carbon footprint.
        </div>
      </div>

      <button class="modal-close" id="modalCloseBtn">Close</button>
    </div>
  </div>
</div>

<!-- Goal Setting Modal -->
<div class="modal" id="goalModal">
  <div class="modal-sheet">
    <div class="modal-handle"></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-icon-big" style="background:linear-gradient(135deg,rgba(74,222,128,.2),rgba(34,197,94,.2));border:1.5px solid rgba(74,222,128,.35);">
          <span>üéØ</span>
        </div>
        <div class="modal-info">
          <h3>Set Weekly Goal</h3>
          <div class="cat">Choose your carbon limit</div>
        </div>
      </div>

      <div style="margin:20px 0;">
        <div style="font-size:13px;color:var(--text-muted);margin-bottom:12px;">Target Carbon Footprint (kg CO‚ÇÇ)</div>
        <input type="number" id="goalInput" class="goal-input" min="1" max="100" step="0.5" value="8.0" placeholder="8.0">
        <div class="goal-suggestions">
          <button class="goal-suggest-btn" data-goal="5">5 kg ‚Äì Strict</button>
          <button class="goal-suggest-btn" data-goal="8">8 kg ‚Äì Moderate</button>
          <button class="goal-suggest-btn" data-goal="12">12 kg ‚Äì Flexible</button>
        </div>
      </div>

      <div style="display:flex;gap:12px;">
        <button class="modal-close" id="goalCancelBtn" style="background:rgba(255,255,255,.05);box-shadow:none;flex:1;">Cancel</button>
        <button class="modal-close" id="goalSaveBtn" style="flex:2;">Save Goal</button>
      </div>
    </div>
  </div>
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CARBON PARTICLES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const carbonField = document.getElementById('carbonField');
const carbonSymbols = ['CO‚ÇÇ', 'üåø', '‚ôªÔ∏è', 'üåç'];
for(let i = 0; i < 15; i++) {
  const p = document.createElement('div');
  p.className = 'carbon-particle';
  p.textContent = carbonSymbols[Math.floor(Math.random() * carbonSymbols.length)];
  p.style.left = Math.random() * 100 + '%';
  p.style.fontSize = (Math.random() * 12 + 16) + 'px';
  p.style.animationDuration = (Math.random() * 20 + 25) + 's';
  p.style.animationDelay = Math.random() * 15 + 's';
  p.style.color = 'rgba(74,222,128,0.2)';
  carbonField.appendChild(p);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let allTransactions = [];
let weeklyGoal = 8.0;
let greenPoints = 0;
let goalStatus = 'active';
let transactionCount = 0;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MERCHANT DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const sampleMerchants = [
  { emoji:'‚òï', name:'Starbucks Coffee', cat:'Eating Places', mcc:'5812', amount:()=>Math.floor(Math.random()*300+200), carbonFactor:1.8, impact:'high',
    tips:['Bring your own reusable cup to save ~0.10kg CO‚ÇÇ per visit.','Choosing plant-based milk reduces emissions by up to 30%!'] },
  { emoji:'üçî', name:"McDonald's", cat:'Fast Food', mcc:'5814', amount:()=>Math.floor(Math.random()*250+150), carbonFactor:1.5, impact:'medium',
    tips:['Try a plant-based burger to cut your meal\'s carbon footprint by 50%.','Dining in uses fewer single-use plastics than takeaway.'] },
  { emoji:'üõí', name:'DMart Grocery', cat:'Grocery Store', mcc:'5411', amount:()=>Math.floor(Math.random()*1000+500), carbonFactor:0.3, impact:'low',
    tips:['Buying local and seasonal produce reduces supply chain emissions.','Bring reusable bags to eliminate plastic waste.'] },
  { emoji:'‚õΩ', name:'Indian Oil Petrol', cat:'Gas Station', mcc:'5541', amount:()=>Math.floor(Math.random()*1500+1000), carbonFactor:2.5, impact:'high',
    tips:['Consider carpooling or public transit to halve your transport emissions.','EVs emit ~70% less CO‚ÇÇ per km than petrol vehicles.'] },
  { emoji:'üçï', name:"Domino's Pizza", cat:'Restaurant', mcc:'5812', amount:()=>Math.floor(Math.random()*400+300), carbonFactor:1.4, impact:'medium',
    tips:['Vegetarian pizzas have roughly 40% lower carbon footprint.','Ordering in bulk for one delivery beats multiple small orders.'] },
  { emoji:'üëï', name:'Zara Fashion', cat:'Clothing Store', mcc:'5691', amount:()=>Math.floor(Math.random()*2000+1000), carbonFactor:0.8, impact:'high',
    tips:['One garment produces ~2.1kg CO‚ÇÇ. Buying second-hand saves 80%.','Washing clothes in cold water cuts energy use by 90%.'] },
  { emoji:'üé¨', name:'PVR Cinemas', cat:'Entertainment', mcc:'7832', amount:()=>Math.floor(Math.random()*500+300), carbonFactor:0.4, impact:'low',
    tips:['Cinema visits are one of the lower-impact entertainment choices.','Choosing nearby venues reduces your travel emissions.'] },
  { emoji:'üèãÔ∏è', name:'Cult.fit Gym', cat:'Health & Fitness', mcc:'7997', amount:()=>Math.floor(Math.random()*1500+1000), carbonFactor:0.2, impact:'low',
    tips:['Working out at a gym has a lower footprint than driving to outdoor activities.','Ask about the gym\'s renewable energy usage!'] }
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PAGE NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function navigateToPage(pageId) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  setTimeout(() => {
    const pg = document.getElementById(pageId);
    if (pg) pg.classList.add('active');
  }, 50);
  document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
  const target = document.querySelector(`[data-page="${pageId}"]`);
  if (target) target.classList.add('active');
}

function navigateTo(pageId) { navigateToPage(pageId); }

document.querySelectorAll('.nav-item[data-page]').forEach(item => {
  item.addEventListener('click', () => navigateToPage(item.getAttribute('data-page')));
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSACTION GENERATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function generateTransaction() {
  const merchant = sampleMerchants[Math.floor(Math.random() * sampleMerchants.length)];
  const amount = merchant.amount();
  const carbon = parseFloat(((amount / 1000) * merchant.carbonFactor).toFixed(1));
  const now = new Date();
  const timeStr = now.toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit', hour12:true });
  const dateStr = now.toLocaleDateString('en-US', { month:'short', day:'numeric', year:'numeric' });

  const txn = {
    id: 'txn_' + Date.now(),
    emoji: merchant.emoji,
    name: merchant.name,
    cat: merchant.cat,
    mcc: merchant.mcc,
    amount, carbon,
    impact: merchant.impact,
    time: timeStr,
    date: dateStr,
    fullDate: now,
    details: `MCC ${merchant.mcc} ¬∑ ${merchant.cat} ¬∑ Just now`,
    tip: merchant.tips[Math.floor(Math.random() * merchant.tips.length)]
  };

  allTransactions.unshift(txn);
  return txn;
}

function createTxnElement(txn) {
  const el = document.createElement('div');
  el.className = 'txn-item';
  el.setAttribute('data-txn', txn.id);
  el.setAttribute('data-impact', txn.impact);
  el.innerHTML = `
    <div class="txn-icon ${txn.impact}">${txn.emoji}</div>
    <div class="txn-info">
      <div class="txn-name">${txn.name}</div>
      <div class="txn-details">${txn.details}</div>
    </div>
    <div class="txn-right">
      <div class="txn-carbon ${txn.impact}">${txn.carbon} kg</div>
      <div class="txn-amount">‚Çπ${txn.amount}</div>
    </div>
  `;
  el.addEventListener('click', function(e) {
    showTransactionModal(txn);
    const r = document.createElement('span');
    const rect = this.getBoundingClientRect();
    r.style.cssText = `position:absolute;border-radius:50%;background:rgba(74,222,128,.15);width:12px;height:12px;left:${e.clientX-rect.left}px;top:${e.clientY-rect.top}px;transform:translate(-50%,-50%) scale(0);animation:rippleAnim .5s ease-out forwards;pointer-events:none;z-index:99`;
    this.appendChild(r);
    setTimeout(() => r.remove(), 500);
  });
  return el;
}

function addTransactionToUI(txn) {
  // Home page
  const homeList = document.getElementById('homeTxnList');
  const homeEmpty = document.getElementById('homeEmptyState');
  if (homeEmpty) homeEmpty.remove();

  const homeEl = createTxnElement(txn);
  homeEl.style.opacity = '0';
  homeEl.style.transform = 'translateY(-20px)';
  homeList.insertBefore(homeEl, homeList.firstChild);
  setTimeout(() => {
    homeEl.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
    homeEl.style.opacity = '1';
    homeEl.style.transform = 'translateY(0)';
  }, 50);

  // Keep only 3 in home
  const homeItems = homeList.querySelectorAll('.txn-item');
  if (homeItems.length > 3) homeItems[homeItems.length - 1].remove();

  // Transactions page
  const txnsList = document.getElementById('transactionsTxnList');
  const txnsEmpty = document.getElementById('txnsEmptyState');
  if (txnsEmpty) txnsEmpty.remove();

  const txnsEl = createTxnElement(txn);
  txnsEl.style.opacity = '0';
  txnsEl.style.transform = 'translateY(-20px)';
  txnsList.insertBefore(txnsEl, txnsList.firstChild);
  setTimeout(() => {
    txnsEl.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
    txnsEl.style.opacity = '1';
    txnsEl.style.transform = 'translateY(0)';
  }, 50);

  // Reapply active filter
  const activeFilter = document.querySelector('.filter-tab.active');
  if (activeFilter) {
    const filter = activeFilter.getAttribute('data-filter');
    if (filter !== 'all') {
      txnsEl.style.display = txn.impact === filter ? 'flex' : 'none';
    }
  }

  updateWeeklyCarbon();
  updateCategoryBreakdown();
  updateWeeklyChart();
  updateComparisonCard();
  updateAchievements();
  transactionCount++;
  checkGoalStatus();
  
  // Award/deduct green points based on transaction impact
  let gpChange = 0;
  const baseGP = Math.floor(txn.amount / 100); // Base GP calculation
  
  if (txn.impact === 'low') {
    // Low impact: Award MORE points (3x base rate = 6 GP per ‚Çπ100)
    gpChange = baseGP * 6;
  } else if (txn.impact === 'medium') {
    // Medium impact: Award fewer points (1x base rate = 2 GP per ‚Çπ100)
    gpChange = baseGP * 2;
  } else if (txn.impact === 'high') {
    // High impact: DEDUCT points (2x base rate = 4 GP per ‚Çπ100)
    gpChange = -(baseGP * 4);
  }
  
  if (gpChange !== 0) {
    greenPoints += gpChange;
    // Don't let GP go negative
    if (greenPoints < 0) greenPoints = 0;
    
    document.getElementById('greenPoints').textContent = greenPoints;
    const el = document.getElementById('rewardsGP'); 
    if (el) el.textContent = greenPoints;
    updateAchievements(); // Update achievements when GP changes
  }
  
  return gpChange; // Return for notification display
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TOAST NOTIFICATION (ccg format)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showToast(title, message, icon = '‚úì', duration = 3000) {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.innerHTML = `
    <div class="toast-content">
      <div class="toast-icon">${icon}</div>
      <div class="toast-text">
        <div class="toast-title">${title}</div>
        <div class="toast-message">${message}</div>
      </div>
    </div>
  `;
  container.appendChild(toast);
  setTimeout(() => toast.classList.add('show'), 10);
  setTimeout(() => {
    toast.classList.remove('show');
    toast.classList.add('hide');
    setTimeout(() => toast.remove(), 400);
  }, duration);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// QR BUTTON HANDLER
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function handleQRScan(e) {
  const btn = e.currentTarget;
  btn.style.transform = 'scale(0.9)';
  setTimeout(() => {
    btn.style.transform = '';
    const txn = generateTransaction();
    const gpChange = addTransactionToUI(txn);
    
    // Create GP notification message
    let gpMessage = '';
    if (gpChange > 0) {
      gpMessage = ` ‚Ä¢ +${gpChange} GP earned! üéâ`;
    } else if (gpChange < 0) {
      gpMessage = ` ‚Ä¢ ${gpChange} GP penalty üòî`;
    } else {
      gpMessage = '';
    }
    
    showToast(
      `${txn.name} ‚Äì ‚Çπ${txn.amount}`,
      `+${txn.carbon} kg CO‚ÇÇ added${gpMessage}`,
      txn.emoji,
      3500
    );
    btn.style.boxShadow = '0 0 20px rgba(74,222,128,.6)';
    setTimeout(() => btn.style.boxShadow = '', 1000);
  }, 200);
}

document.getElementById('qrBtn').addEventListener('click', handleQRScan);
document.getElementById('qrBtn2').addEventListener('click', handleQRScan);
document.getElementById('qrBtn3').addEventListener('click', handleQRScan);
document.getElementById('qrBtn4').addEventListener('click', handleQRScan);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TRANSACTION MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const txnModal = document.getElementById('txnModal');
const txnModalSheet = document.getElementById('txnModalSheet');

function showTransactionModal(txn) {
  document.getElementById('modalEmoji').textContent = txn.emoji;
  document.getElementById('modalName').textContent = txn.name;
  document.getElementById('modalCat').textContent = `${txn.cat} ¬∑ MCC ${txn.mcc}`;
  document.getElementById('modalAmount').textContent = `‚Çπ${txn.amount}`;
  document.getElementById('modalCarbon').textContent = `${txn.carbon} kg CO‚ÇÇ`;
  document.getElementById('modalDate').textContent = `${txn.date} ¬∑ ${txn.time}`;

  const iconEl = document.getElementById('modalIconBig');
  iconEl.className = `modal-icon-big ${txn.impact}`;

  // Build category-specific carbon breakdown from actual transaction data
  const breakdownMap = {
    'Eating Places':    [
      { name:'Food Production & Agriculture', pct:0.55 },
      { name:'Kitchen Energy & Cooking',      pct:0.25 },
      { name:'Packaging & Waste',             pct:0.20 }
    ],
    'Fast Food':        [
      { name:'Meat & Ingredients',            pct:0.50 },
      { name:'Kitchen Operations',            pct:0.30 },
      { name:'Packaging & Delivery',          pct:0.20 }
    ],
    'Restaurant':       [
      { name:'Ingredients & Supply Chain',    pct:0.50 },
      { name:'Cooking & Refrigeration',       pct:0.30 },
      { name:'Packaging & Disposal',          pct:0.20 }
    ],
    'Grocery Store':    [
      { name:'Food & Produce Sourcing',       pct:0.45 },
      { name:'Cold Chain & Refrigeration',    pct:0.35 },
      { name:'Packaging & Transport',         pct:0.20 }
    ],
    'Gas Station':      [
      { name:'Fuel Combustion (direct)',      pct:0.75 },
      { name:'Fuel Refining & Distribution',  pct:0.18 },
      { name:'Station Operations',            pct:0.07 }
    ],
    'Clothing Store':   [
      { name:'Textile Manufacturing',         pct:0.60 },
      { name:'Global Shipping & Logistics',   pct:0.25 },
      { name:'Retail Operations',             pct:0.15 }
    ],
    'Entertainment':    [
      { name:'Venue Energy Use',              pct:0.55 },
      { name:'Travel to Venue',               pct:0.30 },
      { name:'Operations & Equipment',        pct:0.15 }
    ],
    'Health & Fitness': [
      { name:'Facility Electricity',          pct:0.60 },
      { name:'HVAC & Water Heating',          pct:0.25 },
      { name:'Equipment & Maintenance',       pct:0.15 }
    ]
  };

  const breakdownItems = breakdownMap[txn.cat] || [
    { name:'Product/Service Carbon',          pct:0.60 },
    { name:'Transportation & Logistics',      pct:0.25 },
    { name:'Operations & Energy',             pct:0.15 }
  ];

  document.getElementById('carbonBreakdown').innerHTML =
    `<div class="breakdown-title">Carbon Breakdown</div>` +
    breakdownItems.map(b => `<div class="breakdown-item"><div class="name">${b.name}</div><div class="val">${(txn.carbon * b.pct).toFixed(2)} kg</div></div>`).join('');

  document.getElementById('modalTip').innerHTML = `<strong>Eco Tip:</strong> ${txn.tip}`;

  txnModal.classList.add('open');
  document.body.style.overflow = 'hidden';
}

document.getElementById('modalCloseBtn').addEventListener('click', closeModal);
txnModal.addEventListener('click', e => { if (e.target === txnModal) closeModal(); });

function closeModal() {
  txnModal.classList.remove('open');
  document.body.style.overflow = '';
}

// Swipe to close
let touchStartY = 0;
txnModalSheet.addEventListener('touchstart', e => { touchStartY = e.touches[0].clientY; }, {passive:true});
txnModalSheet.addEventListener('touchmove', e => {
  const dy = e.touches[0].clientY - touchStartY;
  if (dy > 0) txnModalSheet.style.transform = `translateY(${dy}px)`;
}, {passive:true});
txnModalSheet.addEventListener('touchend', e => {
  const dy = e.changedTouches[0].clientY - touchStartY;
  txnModalSheet.style.transform = '';
  if (dy > 80) closeModal();
}, {passive:true});

// Ripple animation
const ripStyle = document.createElement('style');
ripStyle.textContent = '@keyframes rippleAnim{to{transform:scale(14);opacity:0;}}';
document.head.appendChild(ripStyle);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GOAL SYSTEM
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateWeeklyCarbon() {
  const total = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
  document.getElementById('weekCarbon').textContent = total.toFixed(1);

  const percentUsed = Math.min((total / weeklyGoal) * 100, 100);
  const circumference = 188.5;
  const offset = circumference - (circumference * percentUsed / 100);
  document.getElementById('goalCircle').style.strokeDashoffset = offset;
  document.querySelector('.goal-ring-label span').textContent = Math.round(percentUsed) + '%';

  const remaining = Math.max(weeklyGoal - total, 0);
  document.querySelector('.goal-info .main').textContent = `${remaining.toFixed(1)} kg away from your Green Goal`;

  const percentRemaining = Math.max(0, ((weeklyGoal - total) / weeklyGoal) * 100);
  document.getElementById('weeklyProgressBar').style.width = `${percentRemaining}%`;

  const badge = document.getElementById('weeklyBadge');
  if (total >= weeklyGoal) {
    badge.textContent = 'Over Goal';
    badge.style.cssText = 'background:rgba(248,113,113,.15);color:#f87171;border-color:rgba(248,113,113,.3);';
  } else if (percentRemaining < 20) {
    badge.textContent = 'Almost There!';
    badge.style.cssText = 'background:rgba(251,191,36,.15);color:#fbbf24;border-color:rgba(251,191,36,.3);';
  } else {
    badge.textContent = 'On Track';
    badge.style.cssText = 'background:rgba(74,222,128,.1);color:#4ade80;border-color:rgba(74,222,128,.25);';
  }

  document.getElementById('weeklyRemaining').textContent = `${remaining.toFixed(1)} kg`;
  document.getElementById('weeklyUsed').textContent = `${total.toFixed(1)} kg`;
  document.getElementById('weeklyGoalDisplay').textContent = `${weeklyGoal.toFixed(1)} kg`;

  // Update profile total
  document.getElementById('profileTotalCarbon').textContent = total.toFixed(1);

  if (transactionCount >= 3 && total < weeklyGoal && goalStatus === 'active') {
    setTimeout(awardGreenPoints, 500);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CATEGORY BREAKDOWN (synced to transactions)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateCategoryBreakdown() {
  const el = document.getElementById('categoryList');
  if (!el) return;

  // Map merchant cats ‚Üí display categories
  const catMap = {
    'Eating Places':  'Food & Dining',
    'Fast Food':      'Food & Dining',
    'Restaurant':     'Food & Dining',
    'Grocery Store':  'Food & Dining',
    'Gas Station':    'Transportation',
    'Clothing Store': 'Shopping',
    'Entertainment':  'Entertainment',
    'Health & Fitness':'Entertainment'
  };

  const catMeta = {
    'Food & Dining':  { icon:'üçï', grad:'linear-gradient(90deg,#fb923c,#fbbf24)' },
    'Transportation': { icon:'‚õΩ', grad:'linear-gradient(90deg,#f87171,#fb923c)' },
    'Shopping':       { icon:'üëï', grad:'linear-gradient(90deg,#fbbf24,#4ade80)' },
    'Entertainment':  { icon:'üé¨', grad:'linear-gradient(90deg,#38bdf8,#4ade80)' }
  };

  // Tally carbon per display category from actual transactions
  const totals = {};
  for (const txn of allTransactions) {
    const display = catMap[txn.cat] || 'Other';
    totals[display] = (totals[display] || 0) + txn.carbon;
  }

  const grand = Object.values(totals).reduce((s, v) => s + v, 0);

  if (grand === 0) {
    el.innerHTML = `<div style="text-align:center;padding:32px 20px;color:var(--text-muted);">
      <div style="font-size:36px;margin-bottom:8px;">üìä</div>
      <div style="font-size:13px;">No transactions yet ‚Äî tap üì∑ to add one</div>
    </div>`;
    return;
  }

  // Sort by carbon descending
  const sorted = Object.entries(totals).sort((a, b) => b[1] - a[1]);
  const maxVal = sorted[0][1];

  el.innerHTML = sorted.map(([cat, val]) => {
    const meta = catMeta[cat] || { icon:'üì¶', grad:'linear-gradient(90deg,#4ade80,#22c55e)' };
    const pct  = grand > 0 ? Math.round((val / grand) * 100) : 0;
    const barW = grand > 0 ? Math.round((val / maxVal) * 100) : 0;
    return `<div class="category-item">
      <div class="cat-icon">${meta.icon}</div>
      <div class="cat-info">
        <div class="cat-name">${cat}</div>
        <div class="cat-bar"><div class="cat-bar-fill" style="width:${barW}%;background:${meta.grad};"></div></div>
      </div>
      <div class="cat-value">
        <div class="cat-carbon">${val.toFixed(1)} kg</div>
        <div class="cat-percent">${pct}%</div>
      </div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE WEEKLY CHART (Insights page)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateWeeklyChart() {
  const chartEl = document.getElementById('weeklyChart');
  if (!chartEl) return;

  const total = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
  
  // Update total display
  const totalEl = document.getElementById('insightsWeeklyTotal');
  if (totalEl) totalEl.textContent = total.toFixed(1) + ' kg CO‚ÇÇ';

  if (total === 0) {
    chartEl.innerHTML = `<div style="text-align:center;padding:40px 20px;color:var(--text-muted);">
      <div style="font-size:36px;margin-bottom:8px;">üìä</div>
      <div style="font-size:13px;">No transactions yet ‚Äî tap üì∑ to add one</div>
    </div>`;
    return;
  }

  // Group transactions by day for a weekly view
  const now = new Date();
  const dailyTotals = {};
  const dayLabels = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
  
  // Initialize last 7 days
  for (let i = 6; i >= 0; i--) {
    const d = new Date(now);
    d.setDate(d.getDate() - i);
    const key = d.toDateString();
    dailyTotals[key] = { carbon: 0, label: dayLabels[d.getDay()] };
  }
  
  // Tally transaction carbon by day
  allTransactions.forEach(txn => {
    const key = txn.fullDate.toDateString();
    if (dailyTotals[key]) {
      dailyTotals[key].carbon += txn.carbon;
    }
  });
  
  const entries = Object.values(dailyTotals);
  const maxCarbon = Math.max(...entries.map(e => e.carbon), 0.1);
  
  chartEl.innerHTML = entries.map((entry, idx) => {
    const height = maxCarbon > 0 ? Math.max((entry.carbon / maxCarbon) * 100, 5) : 5;
    const isToday = idx === entries.length - 1;
    return `<div class="chart-bar${isToday ? ' active' : ''}" style="height:${height}%;">
      <span>${entry.label}<br>${entry.carbon.toFixed(1)}kg</span>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE COMPARISON CARD (Insights page)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateComparisonCard() {
  const yourCarbon = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
  const avgCarbon = weeklyGoal; // Use weekly goal as "average user"
  
  const yourCarbonEl = document.getElementById('yourCarbon');
  const avgCarbonEl = document.getElementById('avgCarbon');
  const yourBarEl = document.getElementById('yourBar');
  const compBadgeEl = document.getElementById('compBadge');
  const compTipEl = document.getElementById('compTip');
  
  if (!yourCarbonEl || !avgCarbonEl || !yourBarEl || !compBadgeEl || !compTipEl) return;
  
  yourCarbonEl.textContent = yourCarbon.toFixed(1) + ' kg';
  avgCarbonEl.textContent = avgCarbon.toFixed(1) + ' kg';
  
  if (yourCarbon === 0) {
    yourBarEl.style.width = '0%';
    compBadgeEl.textContent = '-';
    compBadgeEl.className = 'comp-badge';
    compTipEl.textContent = 'üåü Start adding transactions to see how you compare!';
    return;
  }
  
  const barWidth = Math.min((yourCarbon / avgCarbon) * 100, 100);
  yourBarEl.style.width = barWidth + '%';
  
  if (yourCarbon < avgCarbon) {
    const percentBetter = Math.round(((avgCarbon - yourCarbon) / avgCarbon) * 100);
    compBadgeEl.textContent = percentBetter + '% Better';
    compBadgeEl.className = 'comp-badge good';
    compTipEl.textContent = 'üåü You\'re doing great! Your carbon footprint is lower than average.';
  } else if (yourCarbon > avgCarbon) {
    const percentWorse = Math.round(((yourCarbon - avgCarbon) / avgCarbon) * 100);
    compBadgeEl.textContent = percentWorse + '% Higher';
    compBadgeEl.className = 'comp-badge bad';
    compTipEl.textContent = 'üí° Try reducing your carbon footprint to meet your weekly goal!';
  } else {
    compBadgeEl.textContent = 'On Par';
    compBadgeEl.className = 'comp-badge';
    compTipEl.textContent = 'üëç You\'re right on track with the average user.';
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UPDATE ACHIEVEMENTS (Insights page)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateAchievements() {
  // Eco Starter - first transaction
  const achEcoStarter = document.getElementById('achEcoStarter');
  if (achEcoStarter) {
    if (allTransactions.length >= 1) {
      achEcoStarter.classList.add('earned');
    } else {
      achEcoStarter.classList.remove('earned');
    }
  }
  
  // Goal Getter - met weekly goal
  const achGoalGetter = document.getElementById('achGoalGetter');
  if (achGoalGetter) {
    const total = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
    if (goalStatus === 'success' || (total < weeklyGoal && transactionCount >= 3)) {
      achGoalGetter.classList.add('earned');
    } else {
      achGoalGetter.classList.remove('earned');
    }
  }
  
  // Spend Wise - 5+ transactions
  const achSpendWise = document.getElementById('achSpendWise');
  if (achSpendWise) {
    if (allTransactions.length >= 5) {
      achSpendWise.classList.add('earned');
    } else {
      achSpendWise.classList.remove('earned');
    }
  }
  
  // Point Collector - 50+ GP
  const achPointCollector = document.getElementById('achPointCollector');
  if (achPointCollector) {
    if (greenPoints >= 50) {
      achPointCollector.classList.add('earned');
    } else {
      achPointCollector.classList.remove('earned');
    }
  }
}

function checkGoalStatus() {
  const total = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
  const alert = document.getElementById('goalStatusAlert');

  if (goalStatus === 'active') {
    if (total >= weeklyGoal) {
      goalStatus = 'failed';
      alert.classList.remove('hidden','success');
      alert.classList.add('failed');
      document.getElementById('goalStatusIcon').textContent = 'üò¢';
      document.getElementById('goalStatusTitle').textContent = 'Goal Failed!';
      document.getElementById('goalStatusMessage').textContent = `You exceeded your ${weeklyGoal.toFixed(1)}kg goal. Try again next week!`;
      setTimeout(() => alert.classList.add('hidden'), 5000);
    }
  }
}

function awardGreenPoints() {
  const total = allTransactions.reduce((sum, t) => sum + t.carbon, 0);
  if (goalStatus === 'active' && total < weeklyGoal && transactionCount >= 3) {
    goalStatus = 'success';
    greenPoints += 50;
    document.getElementById('greenPoints').textContent = greenPoints;
    const el = document.getElementById('rewardsGP'); if (el) el.textContent = greenPoints;
    updateAchievements(); // Update achievements when GP awarded
    const alert = document.getElementById('goalStatusAlert');
    alert.classList.remove('hidden','failed');
    alert.classList.add('success');
    document.getElementById('goalStatusIcon').textContent = 'üéâ';
    document.getElementById('goalStatusTitle').textContent = 'Goal Achieved!';
    document.getElementById('goalStatusMessage').textContent = 'You earned 50 Green Points! Keep up the great work!';
    const btn = document.getElementById('setGoalBtn');
    btn.style.transform = 'scale(1.1)';
    setTimeout(() => btn.style.transform = '', 300);
    setTimeout(() => alert.classList.add('hidden'), 6000);
  }
}

// Goal Modal
document.getElementById('setGoalBtn').addEventListener('click', () => {
  document.getElementById('goalInput').value = weeklyGoal.toFixed(1);
  document.getElementById('goalModal').classList.add('open');
  document.body.style.overflow = 'hidden';
});

document.querySelectorAll('.goal-suggest-btn').forEach(btn => {
  btn.addEventListener('click', function() {
    document.getElementById('goalInput').value = parseFloat(this.getAttribute('data-goal')).toFixed(1);
  });
});

document.getElementById('goalSaveBtn').addEventListener('click', function() {
  const newGoal = parseFloat(document.getElementById('goalInput').value);
  if (newGoal && newGoal > 0 && newGoal <= 100) {
    weeklyGoal = newGoal;
    document.getElementById('goalValue').textContent = weeklyGoal.toFixed(1);
    goalStatus = 'active';
    document.getElementById('goalStatusAlert').classList.add('hidden');
    closeGoalModal();
    updateWeeklyCarbon();
    const orig = this.textContent;
    this.textContent = '‚úì Goal Saved!';
    this.style.opacity = '0.8';
    setTimeout(() => { this.textContent = orig; this.style.opacity = ''; }, 1500);
  } else {
    showToast('Invalid Goal', 'Please enter a valid goal between 1 and 100 kg CO‚ÇÇ', '‚ö†Ô∏è');
  }
});

document.getElementById('goalCancelBtn').addEventListener('click', closeGoalModal);
document.getElementById('goalModal').addEventListener('click', e => {
  if (e.target === document.getElementById('goalModal')) closeGoalModal();
});

function closeGoalModal() {
  document.getElementById('goalModal').classList.remove('open');
  document.body.style.overflow = '';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// FILTER TABS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.filter-tab').forEach(tab => {
  tab.addEventListener('click', function() {
    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
    this.classList.add('active');
    const filter = this.getAttribute('data-filter');
    document.querySelectorAll('#transactionsTxnList .txn-item').forEach(item => {
      item.style.display = (filter === 'all' || item.getAttribute('data-impact') === filter) ? 'flex' : 'none';
    });
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PROFILE INTERACTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll('.menu-item').forEach(item => {
  item.addEventListener('click', function() {
    const title = this.querySelector('.menu-title')?.textContent;
    if (title) showToast('Opening', title, 'üì±');
  });
});

document.getElementById('editProfileBtn').addEventListener('click', () => {
  showToast('Coming Soon', 'Edit profile feature is under development', 'üë§');
});

document.getElementById('logoutBtn').addEventListener('click', () => {
  showToast('Logging Out', 'See you soon! üëã', 'üö™');
});
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REWARDS & MERCHANTS DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let claimedRewards = new Set();

const rewardData = {
  solar: { icon:'‚òÄÔ∏è', title:'Solar Panel Discount', subtitle:'Renewable Energy Investment',
    description:'Get 10% off professional solar panel installation from certified partners. Convert your home to clean, renewable energy and reduce your carbon footprint by up to 80%.',
    features:[{icon:'üí∞',text:'Save ‚Çπ80,000-‚Çπ2,50,000 on installation'},{icon:'üîã',text:'25-year performance warranty'},{icon:'üìä',text:'Free energy audit included'},{icon:'üèÜ',text:'Tax credits & incentives guidance'}],
    terms:'Valid for 90 days. One-time use only. Cannot be combined with other offers. Minimum system size 3kW.', cost:100 },
  ev: { icon:'‚ö°', title:'EV Charging Free Month', subtitle:'Electric Vehicle Charging',
    description:'Get 1 month of unlimited charging at any EcoCharge station nationwide. Perfect for electric vehicle owners looking to reduce charging costs.',
    features:[{icon:'üîå',text:'Unlimited charging sessions'},{icon:'üó∫Ô∏è',text:'2,000+ stations nationwide'},{icon:'‚ö°',text:'Fast charging available'},{icon:'üì±',text:'Mobile app access'}],
    terms:'Valid for 30 days from activation. One vehicle only. Not valid for commercial use.', cost:150 },
  wind: { icon:'üåä', title:'Wind Energy Plan Discount', subtitle:'100% Renewable Electricity',
    description:'Switch to 100% wind-powered electricity with 15% off your first year. Support clean energy and reduce your home carbon emissions to zero.',
    features:[{icon:'üí®',text:'100% wind-generated power'},{icon:'üìâ',text:'15% off for 12 months'},{icon:'üåç',text:'Carbon-neutral certified'},{icon:'üìä',text:'Monthly impact reports'}],
    terms:'12-month contract required. Discount applies to energy charges only. Available in select regions.', cost:300 },
  tree: { icon:'üå≥', title:'Plant 10 Trees', subtitle:'Reforestation Project',
    description:'Plant 10 trees in your name through our verified reforestation partners. Each tree absorbs approximately 22 kg of CO‚ÇÇ per year.',
    features:[{icon:'üå±',text:'10 trees planted in verified forests'},{icon:'üìç',text:'GPS coordinates of your trees'},{icon:'üì∏',text:'Planting photos & certificates'},{icon:'üåç',text:'~220 kg CO‚ÇÇ absorbed annually'}],
    terms:'Trees planted within 30 days. Located in reforestation zones. Tracking updates quarterly.', cost:500 },
  coffee: { icon:'‚òï', title:'Eco Caf√© Voucher', subtitle:'Sustainable Coffee',
    description:'‚Çπ400 voucher for eco-friendly caf√©s partnered with CarbonCash. Valid at 200+ locations serving organic, fair-trade coffee.',
    features:[{icon:'‚òï',text:'Valid at 200+ locations'},{icon:'üå±',text:'Organic & fair-trade only'},{icon:'‚ôªÔ∏è',text:'Zero-waste packaging'},{icon:'üíö',text:'Support local businesses'}],
    terms:'Valid for 60 days. One-time use. Cannot be split or combined.', cost:25 },
  'bike-rental': { icon:'üö≤', title:'Bike Rental Week', subtitle:'Green Transportation',
    description:'Get 1 week of free bike rental from BikeShare City. Access thousands of bikes across the city for zero-emission travel.',
    features:[{icon:'üö¥',text:'7 days unlimited rides'},{icon:'üìç',text:'300+ pickup/drop stations'},{icon:'üîê',text:'No deposit required'},{icon:'üì±',text:'Easy app unlock'}],
    terms:'Valid for 7 consecutive days. Standard bikes only. Damage fees may apply.', cost:40 },
  transit: { icon:'üöá', title:'Transit Pass Month', subtitle:'Public Transportation',
    description:'1 month unlimited public transit pass for buses, trains, and metro. Reduce your carbon footprint while saving on commute costs.',
    features:[{icon:'üöå',text:'All buses, trains & metro'},{icon:'üìÖ',text:'30 days unlimited rides'},{icon:'üíµ',text:'Save ~‚Çπ2,500/month'},{icon:'üåç',text:'Reduce CO‚ÇÇ by ~2 kg/day'}],
    terms:'Valid for 30 days from first use. Non-transferable. Express routes included.', cost:120 },
  organic: { icon:'ü•ó', title:'Organic Produce Box', subtitle:'Farm Fresh Delivery',
    description:'Weekly organic produce box delivered to your door. Seasonal fruits and vegetables from local certified organic farms.',
    features:[{icon:'üåæ',text:'Certified organic produce'},{icon:'üöö',text:'Free home delivery'},{icon:'üë®‚Äçüåæ',text:'Support local farms'},{icon:'üì¶',text:'15-20 items per box'}],
    terms:'One delivery only. Available in select pin codes. Substitutions may occur based on availability.', cost:60 }
};

const merchantData = {
  solar: { icon:'‚òÄÔ∏è', name:'SolarPro Solutions', category:'Renewable Energy',
    description:'Leading solar panel installer with 15+ years of experience. Certified installers, premium equipment, and industry-best warranties. Join 10,000+ satisfied customers.',
    features:[{icon:'‚≠ê',text:'15+ years in business'},{icon:'üë•',text:'10,000+ installations'},{icon:'üõ°Ô∏è',text:'25-year warranty'},{icon:'üí∞',text:'Flexible financing options'}],
    stats:[{label:'GP/Purchase',value:'30'},{label:'Max Discount',value:'15%'},{label:'Avg. Savings',value:'‚Çπ2,500'}],
    terms:'Earn 30 GP per ‚Çπ100 spent. Unlock 15% discount with 200+ GP. Free consultation included.',
    website:'https://www.solarpro.com' },
  ev: { icon:'‚ö°', name:'EcoCharge Network', category:'EV Charging',
    description:"Nation's largest EV charging network with 2,100+ stations. Fast charging, reliable service, and competitive rates. Mobile app for easy station location and payment.",
    features:[{icon:'üó∫Ô∏è',text:'2,100+ charging stations'},{icon:'‚ö°',text:'Level 2 & DC fast charging'},{icon:'üì±',text:'iOS & Android apps'},{icon:'üí≥',text:'Pay-as-you-go or subscription'}],
    stats:[{label:'GP/Session',value:'5'},{label:'Stations',value:'2,100'},{label:'Avg. Speed',value:'30 min'}],
    terms:'Earn 5 GP per charging session. Free charging available with 150+ GP membership.',
    website:'https://www.ecocharge.com' },
  grocer: { icon:'üåø', name:'GreenGrocer Market', category:'Organic Food',
    description:'Your neighbourhood organic market featuring locally-sourced produce, sustainable products, and zero-waste options. Supporting local farmers and reducing food miles.',
    features:[{icon:'üåæ',text:'Certified organic produce'},{icon:'üë®‚Äçüåæ',text:'Local farm partnerships'},{icon:'‚ôªÔ∏è',text:'Zero-waste bulk section'},{icon:'ü•¨',text:'Seasonal selections'}],
    stats:[{label:'GP/Week',value:'20'},{label:'Discount',value:'10%'},{label:'Locations',value:'45'}],
    terms:'Earn 2 GP per ‚Çπ10 spent. 10% discount on organic produce with 100+ GP.',
    website:'https://www.greengrocermarket.com' },
  bike: { icon:'üö¥', name:'BikeShare City', category:'Green Transport',
    description:'City-wide bike sharing with 300+ stations. Perfect for short trips, exercise, and reducing your carbon footprint. Easy unlock with our mobile app.',
    features:[{icon:'üö≤',text:'1,000+ bikes available'},{icon:'üìç',text:'300+ stations citywide'},{icon:'üì±',text:'Quick app unlock'},{icon:'üîí',text:'Secure parking stations'}],
    stats:[{label:'GP/Ride',value:'3'},{label:'Pass Discount',value:'20%'},{label:'Avg. Trip',value:'15 min'}],
    terms:'Earn 3 GP per ride. Monthly pass 20% off with 80+ GP.',
    website:'https://www.bikesharecity.com' },
  recycle: { icon:'‚ôªÔ∏è', name:'RecycleHub', category:'Waste Management',
    description:'Comprehensive recycling and waste management services. Accept electronics, batteries, plastics, paper, and more. Proper disposal guaranteed with certified partners.',
    features:[{icon:'üì±',text:'Electronics recycling'},{icon:'üîã',text:'Battery disposal'},{icon:'üóëÔ∏è',text:'Hazardous waste accepted'},{icon:'üìú',text:'Certified disposal'}],
    stats:[{label:'GP/Drop-off',value:'10'},{label:'Materials',value:'50+'},{label:'Centers',value:'120'}],
    terms:'Earn 10 GP per recycling drop-off. Bonus 50 GP for electronics.',
    website:'https://www.recyclehub.com' }
};

const investmentData = {
  'solar': { icon:'‚òÄÔ∏è', title:'Solar Panel Installation', subtitle:'Renewable Energy Investment',
    description:'Professional solar panel installation with 10% discount. Reduce your electricity bills by 50-90% and increase home value. Government subsidies available for up to 30% of system cost.',
    features:[{icon:'üí∞',text:'ROI in 5-7 years typically'},{icon:'üè†',text:'Increases home value by ‚Çπ10L+'},{icon:'‚ö°',text:'Net metering credit available'},{icon:'üõ°Ô∏è',text:'25-year performance warranty'}],
    stats:[{label:'GP Cost',value:'100'},{label:'You Save',value:'10%'},{label:'Avg. System',value:'‚Çπ1.5L'}],
    terms:'Discount valid for 90 days. Minimum 3kW system. Installation within 60 days of purchase.', cost:100 },
  'ev-charging': { icon:'‚ö°', title:'EV Charging Station', subtitle:'Home Charging Solution',
    description:'Level 2 home EV charging station with 15% discount. Full charge overnight, 240V installation included. Smart app controls and energy monitoring.',
    features:[{icon:'üîå',text:'7.2kW fast charging'},{icon:'üì±',text:'WiFi-enabled smart controls'},{icon:'‚öôÔ∏è',text:'Professional installation'},{icon:'‚ö°',text:'0-100% in 6-8 hours'}],
    stats:[{label:'GP Cost',value:'150'},{label:'You Save',value:'15%'},{label:'Install Time',value:'4 hrs'}],
    terms:'Requires 240V circuit. Electrician installation included. 3-year warranty.', cost:150 },
  'wind-energy': { icon:'üåä', title:'Wind Energy Subscription', subtitle:'100% Renewable Electricity',
    description:'Switch to 100% wind-powered electricity with 20% off first year. No installation needed. Cancel anytime with no fees.',
    features:[{icon:'üí®',text:'100% wind-generated'},{icon:'üìâ',text:'20% off for 12 months'},{icon:'üåç',text:'Certified carbon neutral'},{icon:'üìä',text:'Monthly impact reports'}],
    stats:[{label:'GP Cost',value:'200'},{label:'You Save',value:'20%'},{label:'Contract',value:'12 mo'}],
    terms:'12-month minimum term. Available in select states. Price lock guarantee.', cost:200 },
  'green-bonds': { icon:'üìà', title:'Green Bond Investment', subtitle:'Sustainable Finance',
    description:'Invest in green bonds with +2% APY bonus. Support renewable energy, sustainable agriculture, and climate projects while earning competitive returns.',
    features:[{icon:'üíπ',text:'Competitive returns + bonus'},{icon:'üå±',text:'Eco-certified projects only'},{icon:'üîí',text:'Principal protected'},{icon:'üìà',text:'Quarterly dividends'}],
    stats:[{label:'GP Cost',value:'300'},{label:'Bonus APY',value:'+2%'},{label:'Min. Invest',value:'‚Çπ80,000'}],
    terms:'Minimum ‚Çπ80,000 investment. 2-year term. Bonus APY for first year only.', cost:300 },
  'carbon-offset': { icon:'üåç', title:'Carbon Offset Credits', subtitle:'Neutralize Your Footprint',
    description:'Purchase verified carbon offset credits to neutralize your emissions. Support reforestation, renewable energy, and conservation projects worldwide.',
    features:[{icon:'üå≥',text:'5 tons of CO‚ÇÇ offset'},{icon:'‚úì',text:'Gold Standard certified'},{icon:'üìç',text:'Project location tracking'},{icon:'üìú',text:'Official certificate'}],
    stats:[{label:'GP Cost',value:'80'},{label:'CO‚ÇÇ Offset',value:'5 tons'},{label:'Projects',value:'20+'}],
    terms:'Credits retired upon purchase. Certificate delivered via email. Valid internationally.', cost:80 }
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DETAIL MODAL FUNCTIONS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showRewardDetail(type, cost) {
  const data = rewardData[type];
  if (!data) return;
  const modal = document.getElementById('detailModal');
  document.getElementById('detailIcon').textContent = data.icon;
  document.getElementById('detailTitle').textContent = data.title;
  document.getElementById('detailSubtitle').textContent = data.subtitle;
  document.getElementById('detailDescription').textContent = data.description;
  document.getElementById('detailClaimedBadge').style.display = claimedRewards.has(type) ? 'block' : 'none';
  document.getElementById('detailStatsSection').style.display = 'none';
  const featuresSection = document.getElementById('detailFeaturesSection');
  const featuresList = document.getElementById('detailFeatures');
  featuresSection.style.display = 'block';
  featuresList.innerHTML = data.features.map(f =>
    `<div class="detail-feature"><div class="detail-feature-icon">${f.icon}</div><div class="detail-feature-text">${f.text}</div></div>`
  ).join('');
  document.getElementById('detailTermsSection').style.display = 'block';
  document.getElementById('detailTerms').textContent = data.terms;
  const isClaimed = claimedRewards.has(type);
  const canAfford = greenPoints >= cost;
  document.getElementById('detailActions').innerHTML = `
    <div class="detail-btn secondary" onclick="closeDetailModal()">Close</div>
    <div class="detail-btn primary ${isClaimed || !canAfford ? 'disabled' : ''}"
         onclick="${isClaimed || !canAfford ? '' : `claimReward('${type}', ${cost})`}">
      ${isClaimed ? '‚úì Claimed' : (canAfford ? `Claim for ${cost} GP` : `Need ${cost - greenPoints} more GP`)}
    </div>`;
  modal.classList.add('open');
}

function showInvestmentDetail(type, cost) {
  const data = investmentData[type];
  if (!data) return;
  const modal = document.getElementById('detailModal');
  document.getElementById('detailIcon').textContent = data.icon;
  document.getElementById('detailTitle').textContent = data.title;
  document.getElementById('detailSubtitle').textContent = data.subtitle;
  document.getElementById('detailDescription').textContent = data.description;
  document.getElementById('detailClaimedBadge').style.display = claimedRewards.has(type) ? 'block' : 'none';
  const statsSection = document.getElementById('detailStatsSection');
  statsSection.style.display = 'grid';
  statsSection.innerHTML = data.stats.map(s =>
    `<div class="detail-stat"><span class="detail-stat-value">${s.value}</span><span class="detail-stat-label">${s.label}</span></div>`
  ).join('');
  const featuresSection = document.getElementById('detailFeaturesSection');
  featuresSection.style.display = 'block';
  document.getElementById('detailFeatures').innerHTML = data.features.map(f =>
    `<div class="detail-feature"><div class="detail-feature-icon">${f.icon}</div><div class="detail-feature-text">${f.text}</div></div>`
  ).join('');
  document.getElementById('detailTermsSection').style.display = 'block';
  document.getElementById('detailTerms').textContent = data.terms;
  const isClaimed = claimedRewards.has(type);
  const canAfford = greenPoints >= cost;
  document.getElementById('detailActions').innerHTML = `
    <div class="detail-btn secondary" onclick="closeDetailModal()">Close</div>
    <div class="detail-btn primary ${isClaimed || !canAfford ? 'disabled' : ''}"
         onclick="${isClaimed || !canAfford ? '' : `redeemInvestment('${type}', ${cost})`}">
      ${isClaimed ? '‚úì Redeemed' : (canAfford ? `Redeem for ${cost} GP` : `Need ${cost - greenPoints} more GP`)}
    </div>`;
  modal.classList.add('open');
}

function showMerchantDetail(type) {
  const data = merchantData[type];
  if (!data) return;
  const modal = document.getElementById('detailModal');
  document.getElementById('detailIcon').textContent = data.icon;
  document.getElementById('detailTitle').textContent = data.name;
  document.getElementById('detailSubtitle').textContent = data.category;
  document.getElementById('detailDescription').textContent = data.description;
  document.getElementById('detailClaimedBadge').style.display = 'none';
  const statsSection = document.getElementById('detailStatsSection');
  statsSection.style.display = 'grid';
  statsSection.innerHTML = data.stats.map(s =>
    `<div class="detail-stat"><span class="detail-stat-value">${s.value}</span><span class="detail-stat-label">${s.label}</span></div>`
  ).join('');
  const featuresSection = document.getElementById('detailFeaturesSection');
  featuresSection.style.display = 'block';
  document.getElementById('detailFeatures').innerHTML = data.features.map(f =>
    `<div class="detail-feature"><div class="detail-feature-icon">${f.icon}</div><div class="detail-feature-text">${f.text}</div></div>`
  ).join('');
  document.getElementById('detailTermsSection').style.display = 'block';
  document.getElementById('detailTerms').textContent = data.terms;
  document.getElementById('detailActions').innerHTML = `
    <div class="detail-btn secondary" onclick="closeDetailModal(); saveMerchant('${data.name}')">üíö Save</div>
    <div class="detail-btn primary" onclick="closeDetailModal(); visitMerchant('${type}')">Visit Store</div>`;
  modal.classList.add('open');
}

function closeDetailModal() {
  document.getElementById('detailModal').classList.remove('open');
}

function claimReward(type, cost) {
  if (claimedRewards.has(type)) { closeDetailModal(); showToast('Already Claimed', 'You have already claimed this reward!', '‚ö†Ô∏è'); return; }
  if (greenPoints >= cost) {
    greenPoints -= cost;
    claimedRewards.add(type);
    document.getElementById('greenPoints').textContent = greenPoints;
    document.getElementById('rewardsGP').textContent = greenPoints;
    closeDetailModal();
    showToast('Reward Claimed!', `${rewardData[type]?.title} ‚Ä¢ Check your email for details`, 'üéâ', 4000);
  } else {
    closeDetailModal();
    showToast('Not Enough Points', `You need ${cost - greenPoints} more GP to claim this reward`, 'üí∞');
  }
}

function redeemInvestment(type, cost) {
  if (claimedRewards.has(type)) { closeDetailModal(); showToast('Already Redeemed', 'You have already redeemed this!', '‚ö†Ô∏è'); return; }
  if (greenPoints >= cost) {
    greenPoints -= cost;
    claimedRewards.add(type);
    document.getElementById('greenPoints').textContent = greenPoints;
    document.getElementById('rewardsGP').textContent = greenPoints;
    closeDetailModal();
    showToast('Investment Redeemed!', `${investmentData[type]?.title} ‚Ä¢ Check your email for the discount code`, 'üéâ', 4000);
  } else {
    closeDetailModal();
    showToast('Not Enough Points', `You need ${cost - greenPoints} more GP`, 'üí∞');
  }
}

function visitMerchant(type) {
  const data = merchantData[type];
  if (data && data.website) {
    showToast('Opening Store', `Redirecting to ${data.name}‚Ä¶`, 'üè™');
    setTimeout(() => {
      window.open(data.website, '_blank');
    }, 500);
  } else {
    showToast('Coming Soon', 'Store website will be available soon', 'üè™');
  }
}

function saveMerchant(name) {
  showToast('Saved!', `${name} added to your favourites üíö`, '‚≠ê');
}

// Close detail modal on backdrop click
document.getElementById('detailModal').addEventListener('click', function(e) {
  if (e.target === this) closeDetailModal();
});

// Update rewardsGP when green points change
function updateRewardsGP() {
  const el = document.getElementById('rewardsGP');
  if (el) el.textContent = greenPoints;
}

</script>
</body>
</html>